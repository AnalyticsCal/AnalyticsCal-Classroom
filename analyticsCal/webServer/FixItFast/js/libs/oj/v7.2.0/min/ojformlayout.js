/**
 * @license
 * Copyright (c) 2014, 2019, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
define(["ojs/ojcore","ojs/ojcontext","ojs/ojcomponentcore","ojs/ojlabel","ojs/ojlogger"],function(e,t,o,n,a){"use strict";var l={properties:{direction:{type:"string",enumValues:["column","row"],value:"column"},labelEdge:{type:"string",enumValues:["start","top"],value:"top"},labelWidth:{type:"string",value:"33%"},labelWrapping:{type:"string",enumValues:["truncate","wrap"],value:"wrap"},maxColumns:{type:"number",value:1}},methods:{setProperty:{},getProperty:{},setProperties:{},refresh:{},getNodeBySubId:{},getSubIdByNode:{}},extension:{}};Object.freeze(l);var i=0;function r(e){var o,n,l,r,s,d,u=this,c=e.element,m="-labelled-by",f="data-oj-formlayout-bonus-dom",h="["+f+"]",v=!0,b=!1;function p(){n&&(n(),n=null)}function y(){o&&(o(),o=null)}function g(e){var o=null;return e instanceof Element&&"labelHint"in e&&""!==e.labelHint&&(M(e),o=function(e){var t=e.tagName.toLowerCase(),o=document.createElement("oj-label");o.setAttribute(f,""),o.setAttribute("data-oj-internal",""),o.setAttribute("data-oj-binding-provider","none"),o.setAttribute("data-oj-context",""),"start"!==c.labelEdge||"oj-checkboxset"!==t&&"oj-radioset"!==t||o.classList.add(t+"-label");var n=document.createElement("span");return n.id=e.id+"|hint",n.textContent=e.labelHint,o.appendChild(n),function(e,t){var o=e,n=t;o.id=n.id+m,o.setAttribute("for",n.id)}(o,e),o}(e),e.parentElement.insertBefore(o,e),function(e,o){var n=o;t.getContext(n).getBusyContext().whenReady().then(function(){var t=e.helpHints;t&&(t.definition||t.source)&&(n.help=t),n.showRequired=e.required})}(e,o),function(e){e.addEventListener("labelHintChanged",j),e.addEventListener("helpHintsChanged",x),e.addEventListener("requiredChanged",C)}(e)),o}function j(e){var t=e.target,o=document.getElementById(t.id+"|hint");o&&(o.innerText=e.detail.value)}function x(e){var t=L(e.target);t&&(t.help=e.detail.value)}function C(e){var t=L(e.target);t&&(t.showRequired=e.detail.value)}function L(e){return"labelledBy"in e?document.getElementById(e.labelledBy):c.querySelector('oj-label[for="'+e.id+'"]')}function E(e,t){var o=1;return"column"===c.direction?"100%":(e&&"colspan"in e&&e.colspan&&(o=Math.min(Math.floor(e.colspan),t)),Math.floor(1e5/c.maxColumns)/1e3*o+"%")}function w(e,t){var o=O("oj-flex-item");return o.style.webkitFlex="0 1 "+t,o.style.flex="0 1 "+t,o.style.maxWidth=t,o.style.width=t,e.appendChild(o),o}function N(e,t,o,n){var a,l;a=o?O("oj-flex"):e.previousElementSibling;var i=t?function(){if(!d&&(d=s,"start"===c.labelEdge&&"row"===c.direction)){var e=c.labelWidth.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/);switch(e[2]){case"vw":case"vmin":case"vmax":case"%":d=e[1]/c.maxColumns+e[2]}}return d}():E(e,n);t||(l=w(a,"0px"));var r=O("oj-flex-item");if(a.appendChild(r),e.parentElement.insertBefore(a,e),r.appendChild(e),r.style.flex="0 0 "+i,r.style.maxWidth=i,r.style.width=i,t){var u=O("oj-flex-item");a.appendChild(u),"row"===c.direction&&"top"===c.labelEdge&&(u.appendChild(e),r.style.webkitFlex="0 1 0px",r.style.flex="0 1 0px",r.style.maxWidth="0px",r.style.width="0px",r.classList.add("oj-formlayout-label-comp-flex-item"),u.classList.add("oj-formlayout-label-comp-flex-item")),u.appendChild(t),u.style.webkitFlex="1 1 0",u.style.flex="1 1 0","OJ-FORM-LAYOUT"===t.tagName&&u.classList.add("oj-formlayout-nested-formlayout")}else l.classList.add("oj-formlayout-no-label-flex-item"),r.classList.add("oj-formlayout-no-label-flex-item"),"OJ-LABEL-VALUE"===e.tagName?(l.classList.add("oj-formlayout-nested-labelvalue"),r.classList.add("oj-formlayout-nested-labelvalue"),e.setAttribute("data-oj-colspan",n),e.refresh()):"OJ-FORM-LAYOUT"===e.tagName&&r.classList.add("oj-formlayout-nested-formlayout");return a}function O(e){var t=document.createElement("div");return t.setAttribute(f,""),t.setAttribute("data-oj-internal",""),t.classList.add(e),t}function A(e){for(var t=e,o=!0;t!==c;){if("OJ-FORM-LAYOUT"===t.tagName){o=!1;break}if(null==(t=t.parentElement)){o=!1;break}}return o}function B(e){for(;e.firstElementChild;)e.parentNode.insertBefore(e.firstElementChild,e);e.parentNode.removeChild(e)}function M(e){var t=e;t.id||(t.id="oflId_"+i,i+=1)}u._rootElementMutationObserver=new MutationObserver(function(e){document.body.contains(c)?(!function(e){for(var t=e.length,o=0;o<t;o++){var n=e[o];if("childList"===n.type)for(var a=n.addedNodes.length,i=0;i<a;i++){var r=n.addedNodes[i];r.parentNode===c&&l.appendChild(r)}}}(e),function(e){for(var t=!0,o=e.length,n=["colspan","label-hint"],a=0;a<o;a++){var l=e[a];if("childList"===l.type&&((i=l.target)===c||i&&"DIV"===i.tagName&&i.hasAttribute(f))&&A(l.target)){t=!1;break}if("attributes"===l.type&&-1!==n.indexOf(l.attributeName)){t=!1;break}}var i;return t}(e)||(!function(e){for(var t=e.length,o=0;o<t;o++){var n=e[o];if("childList"===n.type)for(var a=n.removedNodes.length,l=0;l<a;l++){var i=n.removedNodes[l];1===i.nodeType&&(i.removeEventListener("labelHintChanged",j),i.removeEventListener("helpHintsChanged",x),i.removeEventListener("requiredChanged",C))}}}(e),c.refresh())):this.disconnect()}),this.createDOM=function(){for(c.classList.add("oj-form-layout"),(l=document.createElement("div")).classList.add("oj-form"),l.setAttribute("data-oj-context",""),l.setAttribute("data-oj-internal",""),l.setAttribute(f,"");c.firstChild;)l.appendChild(c.firstChild);c.appendChild(l)},this.updateDOM=function(){function e(){!function(){if(!n){var e=t.getContext(c).getBusyContext(),o={description:"The oj-form-layout component with id = '"+c.id+"' is being rendered."};n=e.addBusyState(o)}}(),r=[],d=null,s="start"===c.labelEdge?c.labelWidth:"100%",t.getContext(l).getBusyContext().whenReady().then(function(){!function(){if(!o){var e=t.getContext(l).getBusyContext(),n={description:"The oj-form div for oj-form-layout component with id = '"+c.id+"' is being rendered."};o=e.addBusyState(n)}}(),u._rootElementMutationObserver.disconnect(),function(){var e=c.maxColumns;if("start"===c.labelEdge){var t=parseInt(c.labelWidth,10);(isNaN(t)||t>0)&&l.classList.add("oj-form-cols-labels-inline"),l.classList.add("oj-formlayout-labels-inline"),l.classList.remove("oj-form-cols")}else l.classList.add("oj-form-cols"),l.classList.remove("oj-form-cols-labels-inline"),l.classList.remove("oj-formlayout-labels-inline");"truncate"===c.labelWrapping?l.classList.add("oj-formlayout-labels-nowrap"):l.classList.remove("oj-formlayout-labels-nowrap");"row"===c.direction?(e=1,l.classList.add("oj-formlayout-form-across")):(e=c.maxColumns,l.classList.remove("oj-formlayout-form-across"));l.style.columnCount=e,l.style.webkitColumnCount=e,l.style.MozColumnCount=e}(),v||function(){for(var e=l.querySelectorAll(h),t=e.length,o=0;o<t;++o){var n=e[o];A(n)&&("OJ-LABEL"===n.tagName?n.parentElement.removeChild(n):B(n))}}(),function(){var e=l.firstElementChild,t=0,o="column"===c.direction;for(;e;){var n=e.tagName.toLowerCase();if(-1!==n.indexOf("-"))if("oj-label"===n){var a=e;if(!(e=e.nextElementSibling))throw M(c),M(a),y(),p(),new Error("oj-form-layout component with id='"+c.id+"' has an oj-label child element with id='"+a.id+"' but has no next sibling element that it is associated with.")}else"oj-label-value"===n?v||e.refresh():e.classList.contains("oj-complete")?g(e):((o||t%c.maxColumns==0)&&e.setAttribute("data-oj-needs-oj-flex-div",""),r.push(e));t+=1,e=e.nextElementSibling}}(),function(){var e,t=[],o=l.children.length,n="column"===c.direction,i=0,s=0;!function(e,t){for(var o=t,n=e.length-1;n>=0;n--)o[n]=e[n]}(l.children,t);var d,u=c.maxColumns,m=0,f=!1,h=!1;for(;i<o;){var v=t[i];if(d=1,-1===r.indexOf(v)){var b=v.tagName.toLowerCase();if("oj-label"===b){var p=t[i+=1];e=N(v,p,n||s%u==0)}else"colspan"in v&&""!==v.colspan&&(n?f||(a.error('Colspan attribute is ignored unless direction is set to "row"'),f=!0):(d=Math.min(Math.floor(v.colspan),u-m),!h&&u>1&&(h=!0))),e=N(v,null,n||s%u==0,d)}m=(s+=d)%u,i+=1}h&&!n?l.classList.add("oj-form-control-full-width"):l.classList.remove("oj-form-control-full-width");!function(e,t){var o=c.maxColumns,n=t%o,a=E();if("column"!==c.direction&&e&&n>0)for(var l=n;l<o;l++)w(e,a)}(e,s)}(),u._rootElementMutationObserver.observe(c,{childList:!0,subtree:!0,attributes:!0}),y(),p(),v&&(v=!1)})}var i;b||(!(v||!c.hasAttribute("data-oj-context"))&&!(i=t.getContext(c).getBusyContext()).isReady()?(b=!0,i.whenReady().then(function(){b=!1,e()})):e())}}l.extension._CONSTRUCTOR=r,l.extension._TRACK_CHILDREN="nearestCustomElement",e.CustomElementBridge.register("oj-form-layout",{metadata:l})});
/**
 * @license
 * Copyright (c) 2014, 2019, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.PouchDB=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){return function(){var b=arguments.length;if(b){for(var c=[],d=-1;++d<b;)c[d]=arguments[d];return a.call(this,c)}return a.call(this,[])}}b.exports=d},{}],2:[function(a,b,c){(function(d){function e(){return!("undefined"==typeof window||!window||void 0===window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function f(a){var b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),b){var d="color: "+this.color;a.splice(1,0,d,"color: inherit");var e=0,f=0;a[0].replace(/%[a-zA-Z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d)}}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function h(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(a){}}function i(){var a;try{a=c.storage.debug}catch(a){}return!a&&void 0!==d&&"env"in d&&(a=d.env.DEBUG),a}c=b.exports=a(3),c.log=g,c.formatArgs=f,c.save=h,c.load=i,c.useColors=e,c.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(a){}}(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){try{return JSON.stringify(a)}catch(a){return"[UnexpectedJSONParseError]: "+a.message}},c.enable(i())}).call(this,a(9))},{3:3,9:9}],3:[function(a,b,c){function d(a){var b,d=0;for(b in a)d=(d<<5)-d+a.charCodeAt(b),d|=0;return c.colors[Math.abs(d)%c.colors.length]}function e(a){function b(){if(b.enabled){var a=b,d=+new Date,e=d-(j||d);a.diff=e,a.prev=j,a.curr=d,j=d;for(var f=new Array(arguments.length),g=0;g<f.length;g++)f[g]=arguments[g];f[0]=c.coerce(f[0]),"string"!=typeof f[0]&&f.unshift("%O");var h=0;f[0]=f[0].replace(/%([a-zA-Z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var g=f[h];b=e.call(a,g),f.splice(h,1),h--}return b}),c.formatArgs.call(a,f);(b.log||c.log||console.log.bind(console)).apply(a,f)}}return b.namespace=a,b.enabled=c.enabled(a),b.useColors=c.useColors(),b.color=d(a),"function"==typeof c.init&&c.init(b),b}function f(a){c.save(a),c.names=[],c.skips=[];for(var b=("string"==typeof a?a:"").split(/[\s,]+/),d=b.length,e=0;e<d;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;b<d;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;b<d;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e.debug=e.default=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a(8),c.names=[],c.skips=[],c.formatters={};var j},{8:8}],4:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if((b=arguments[1])instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners)&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace()),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){return this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],5:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||void 0===a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],7:[function(a,b,c){"use strict";function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(b){return p.reject(a,b)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;if(a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof b)return function(){b.apply(a,arguments)}}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status="success"}catch(a){c.status="error",c.value=a}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){var b=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var c=a.length,e=!1;if(!c)return this.resolve([]);for(var f=new Array(c),g=0,h=-1,i=new this(d);++h<c;)!function(a,d){function h(a){f[d]=a,++g!==c||e||(e=!0,p.resolve(i,f))}b.resolve(a).then(h,function(a){e||(e=!0,p.reject(i,a))})}(a[h],h);return i}function n(a){var b=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var c=a.length,e=!1;if(!c)return this.resolve([]);for(var f=-1,g=new this(d);++f<c;)!function(a){b.resolve(a).then(function(a){e||(e=!0,p.resolve(g,a))},function(a){e||(e=!0,p.reject(g,a))})}(a[f]);return g}var o=a(5),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=e,e.prototype.catch=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){g(c,this.state===r?a:b,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},e.resolve=k,e.reject=l,e.all=m,e.race=n},{5:5}],8:[function(a,b,c){function d(a){if(a=String(a),!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]);switch((b[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"hrs":case"hr":case"h":return c*j;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){b=b||{};var c=typeof a;if("string"===c&&a.length>0)return d(a);if("number"===c&&!1===isNaN(a))return b.long?f(a):e(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))}},{}],9:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.prependListener=k,n.prependOnceListener=k,n.listeners=function(a){return[]},n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],10:[function(b,c,d){!function(b){if("object"==typeof d)c.exports=b();else if("function"==typeof a&&a.amd)a(b);else{var e;try{e=window}catch(a){e=self}e.SparkMD5=b()}}(function(a){"use strict";function b(a,b){var c=a[0],d=a[1],e=a[2],f=a[3];c+=(d&e|~d&f)+b[0]-680876936|0,c=(c<<7|c>>>25)+d|0,f+=(c&d|~c&e)+b[1]-389564586|0,f=(f<<12|f>>>20)+c|0,e+=(f&c|~f&d)+b[2]+606105819|0,e=(e<<17|e>>>15)+f|0,d+=(e&f|~e&c)+b[3]-1044525330|0,d=(d<<22|d>>>10)+e|0,c+=(d&e|~d&f)+b[4]-176418897|0,c=(c<<7|c>>>25)+d|0,f+=(c&d|~c&e)+b[5]+1200080426|0,f=(f<<12|f>>>20)+c|0,e+=(f&c|~f&d)+b[6]-1473231341|0,e=(e<<17|e>>>15)+f|0,d+=(e&f|~e&c)+b[7]-45705983|0,d=(d<<22|d>>>10)+e|0,c+=(d&e|~d&f)+b[8]+1770035416|0,c=(c<<7|c>>>25)+d|0,f+=(c&d|~c&e)+b[9]-1958414417|0,f=(f<<12|f>>>20)+c|0,e+=(f&c|~f&d)+b[10]-42063|0,e=(e<<17|e>>>15)+f|0,d+=(e&f|~e&c)+b[11]-1990404162|0,d=(d<<22|d>>>10)+e|0,c+=(d&e|~d&f)+b[12]+1804603682|0,c=(c<<7|c>>>25)+d|0,f+=(c&d|~c&e)+b[13]-40341101|0,f=(f<<12|f>>>20)+c|0,e+=(f&c|~f&d)+b[14]-1502002290|0,e=(e<<17|e>>>15)+f|0,d+=(e&f|~e&c)+b[15]+1236535329|0,d=(d<<22|d>>>10)+e|0,c+=(d&f|e&~f)+b[1]-165796510|0,c=(c<<5|c>>>27)+d|0,f+=(c&e|d&~e)+b[6]-1069501632|0,f=(f<<9|f>>>23)+c|0,e+=(f&d|c&~d)+b[11]+643717713|0,e=(e<<14|e>>>18)+f|0,d+=(e&c|f&~c)+b[0]-373897302|0,d=(d<<20|d>>>12)+e|0,c+=(d&f|e&~f)+b[5]-701558691|0,c=(c<<5|c>>>27)+d|0,f+=(c&e|d&~e)+b[10]+38016083|0,f=(f<<9|f>>>23)+c|0,e+=(f&d|c&~d)+b[15]-660478335|0,e=(e<<14|e>>>18)+f|0,d+=(e&c|f&~c)+b[4]-405537848|0,d=(d<<20|d>>>12)+e|0,c+=(d&f|e&~f)+b[9]+568446438|0,c=(c<<5|c>>>27)+d|0,f+=(c&e|d&~e)+b[14]-1019803690|0,f=(f<<9|f>>>23)+c|0,e+=(f&d|c&~d)+b[3]-187363961|0,e=(e<<14|e>>>18)+f|0,d+=(e&c|f&~c)+b[8]+1163531501|0,d=(d<<20|d>>>12)+e|0,c+=(d&f|e&~f)+b[13]-1444681467|0,c=(c<<5|c>>>27)+d|0,f+=(c&e|d&~e)+b[2]-51403784|0,f=(f<<9|f>>>23)+c|0,e+=(f&d|c&~d)+b[7]+1735328473|0,e=(e<<14|e>>>18)+f|0,d+=(e&c|f&~c)+b[12]-1926607734|0,d=(d<<20|d>>>12)+e|0,c+=(d^e^f)+b[5]-378558|0,c=(c<<4|c>>>28)+d|0,f+=(c^d^e)+b[8]-2022574463|0,f=(f<<11|f>>>21)+c|0,e+=(f^c^d)+b[11]+1839030562|0,e=(e<<16|e>>>16)+f|0,d+=(e^f^c)+b[14]-35309556|0,d=(d<<23|d>>>9)+e|0,c+=(d^e^f)+b[1]-1530992060|0,c=(c<<4|c>>>28)+d|0,f+=(c^d^e)+b[4]+1272893353|0,f=(f<<11|f>>>21)+c|0,e+=(f^c^d)+b[7]-155497632|0,e=(e<<16|e>>>16)+f|0,d+=(e^f^c)+b[10]-1094730640|0,d=(d<<23|d>>>9)+e|0,c+=(d^e^f)+b[13]+681279174|0,c=(c<<4|c>>>28)+d|0,f+=(c^d^e)+b[0]-358537222|0,f=(f<<11|f>>>21)+c|0,e+=(f^c^d)+b[3]-722521979|0,e=(e<<16|e>>>16)+f|0,d+=(e^f^c)+b[6]+76029189|0,d=(d<<23|d>>>9)+e|0,c+=(d^e^f)+b[9]-640364487|0,c=(c<<4|c>>>28)+d|0,f+=(c^d^e)+b[12]-421815835|0,f=(f<<11|f>>>21)+c|0,e+=(f^c^d)+b[15]+530742520|0,e=(e<<16|e>>>16)+f|0,d+=(e^f^c)+b[2]-995338651|0,d=(d<<23|d>>>9)+e|0,c+=(e^(d|~f))+b[0]-198630844|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[7]+1126891415|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[14]-1416354905|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[5]-57434055|0,d=(d<<21|d>>>11)+e|0,c+=(e^(d|~f))+b[12]+1700485571|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[3]-1894986606|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[10]-1051523|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[1]-2054922799|0,d=(d<<21|d>>>11)+e|0,c+=(e^(d|~f))+b[8]+1873313359|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[15]-30611744|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[6]-1560198380|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[13]+1309151649|0,d=(d<<21|d>>>11)+e|0,c+=(e^(d|~f))+b[4]-145523070|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[11]-1120210379|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[2]+718787259|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[9]-343485551|0,d=(d<<21|d>>>11)+e|0,a[0]=c+a[0]|0,a[1]=d+a[1]|0,a[2]=e+a[2]|0,a[3]=f+a[3]|0}function c(a){var b,c=[];for(b=0;b<64;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c}function d(a){var b,c=[];for(b=0;b<64;b+=4)c[b>>2]=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c}function e(a){var d,e,f,g,h,i,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(d=64;d<=j;d+=64)b(k,c(a.substring(d-64,d)));for(a=a.substring(d-64),e=a.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=0;d<e;d+=1)f[d>>2]|=a.charCodeAt(d)<<(d%4<<3);if(f[d>>2]|=128<<(d%4<<3),d>55)for(b(k,f),d=0;d<16;d+=1)f[d]=0;return g=8*j,g=g.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(g[2],16),i=parseInt(g[1],16)||0,f[14]=h,f[15]=i,b(k,f),k}function f(a){var c,e,f,g,h,i,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(c=64;c<=j;c+=64)b(k,d(a.subarray(c-64,c)));for(a=c-64<j?a.subarray(c-64):new Uint8Array(0),e=a.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=0;c<e;c+=1)f[c>>2]|=a[c]<<(c%4<<3);if(f[c>>2]|=128<<(c%4<<3),c>55)for(b(k,f),c=0;c<16;c+=1)f[c]=0;return g=8*j,g=g.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(g[2],16),i=parseInt(g[1],16)||0,f[14]=h,f[15]=i,b(k,f),k}function g(a){var b,c="";for(b=0;b<4;b+=1)c+=o[a>>8*b+4&15]+o[a>>8*b&15];return c}function h(a){var b;for(b=0;b<a.length;b+=1)a[b]=g(a[b]);return a.join("")}function i(a){return/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a))),a}function j(a,b){var c,d=a.length,e=new ArrayBuffer(d),f=new Uint8Array(e);for(c=0;c<d;c+=1)f[c]=a.charCodeAt(c);return b?f:e}function k(a){return String.fromCharCode.apply(null,new Uint8Array(a))}function l(a,b,c){var d=new Uint8Array(a.byteLength+b.byteLength);return d.set(new Uint8Array(a)),d.set(new Uint8Array(b),a.byteLength),c?d:d.buffer}function m(a){var b,c=[],d=a.length;for(b=0;b<d-1;b+=2)c.push(parseInt(a.substr(b,2),16));return String.fromCharCode.apply(String,c)}function n(){this.reset()}var o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==h(e("hello"))&&function(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function b(a,b){return a=0|a||0,a<0?Math.max(a+b,0):Math.min(a,b)}ArrayBuffer.prototype.slice=function(c,d){var e,f,g,h,i=this.byteLength,j=b(c,i),k=i;return d!==a&&(k=b(d,i)),j>k?new ArrayBuffer(0):(e=k-j,f=new ArrayBuffer(e),g=new Uint8Array(f),h=new Uint8Array(this,j,e),g.set(h),f)}}(),n.prototype.append=function(a){return this.appendBinary(i(a)),this},n.prototype.appendBinary=function(a){this._buff+=a,this._length+=a.length;var d,e=this._buff.length;for(d=64;d<=e;d+=64)b(this._hash,c(this._buff.substring(d-64,d)));return this._buff=this._buff.substring(d-64),this},n.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;b<e;b+=1)f[b>>2]|=d.charCodeAt(b)<<(b%4<<3);return this._finish(f,e),c=h(this._hash),a&&(c=m(c)),this.reset(),c},n.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},n.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},n.prototype.setState=function(a){return this._buff=a.buff,this._length=a.length,this._hash=a.hash,this},n.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},n.prototype._finish=function(a,c){var d,e,f,g=c;if(a[g>>2]|=128<<(g%4<<3),g>55)for(b(this._hash,a),g=0;g<16;g+=1)a[g]=0;d=8*this._length,d=d.toString(16).match(/(.*?)(.{0,8})$/),e=parseInt(d[2],16),f=parseInt(d[1],16)||0,a[14]=e,a[15]=f,b(this._hash,a)},n.hash=function(a,b){return n.hashBinary(i(a),b)},n.hashBinary=function(a,b){var c=e(a),d=h(c);return b?m(d):d},n.ArrayBuffer=function(){this.reset()},n.ArrayBuffer.prototype.append=function(a){var c,e=l(this._buff.buffer,a,!0),f=e.length;for(this._length+=a.byteLength,c=64;c<=f;c+=64)b(this._hash,d(e.subarray(c-64,c)));return this._buff=c-64<f?new Uint8Array(e.buffer.slice(c-64)):new Uint8Array(0),this},n.ArrayBuffer.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;b<e;b+=1)f[b>>2]|=d[b]<<(b%4<<3);return this._finish(f,e),c=h(this._hash),a&&(c=m(c)),this.reset(),c},n.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},n.ArrayBuffer.prototype.getState=function(){var a=n.prototype.getState.call(this);return a.buff=k(a.buff),a},n.ArrayBuffer.prototype.setState=function(a){return a.buff=j(a.buff,!0),n.prototype.setState.call(this,a)},n.ArrayBuffer.prototype.destroy=n.prototype.destroy,n.ArrayBuffer.prototype._finish=n.prototype._finish,n.ArrayBuffer.hash=function(a,b){var c=f(new Uint8Array(a)),d=h(c);return b?m(d):d},n})},{}],11:[function(a,b,c){var d=a(14),e=a(15),f=e;f.v1=d,f.v4=e,b.exports=f},{14:14,15:15}],12:[function(a,b,c){function d(a,b){var c=b||0,d=e;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}for(var e=[],f=0;f<256;++f)e[f]=(f+256).toString(16).substr(1);b.exports=d},{}],13:[function(a,b,c){(function(a){var c,d=a.crypto||a.msCrypto;if(d&&d.getRandomValues){var e=new Uint8Array(16);c=function(){return d.getRandomValues(e),e}}if(!c){var f=new Array(16);c=function(){for(var a,b=0;b<16;b++)0==(3&b)&&(a=4294967296*Math.random()),f[b]=a>>>((3&b)<<3)&255;return f}}b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(a,b,c){function d(a,b,c){var d=b&&c||0,e=b||[];a=a||{};var g=void 0!==a.clockseq?a.clockseq:i,l=void 0!==a.msecs?a.msecs:(new Date).getTime(),m=void 0!==a.nsecs?a.nsecs:k+1,n=l-j+(m-k)/1e4;if(n<0&&void 0===a.clockseq&&(g=g+1&16383),(n<0||l>j)&&void 0===a.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");j=l,k=m,i=g,l+=122192928e5;var o=(1e4*(268435455&l)+m)%4294967296;e[d++]=o>>>24&255,e[d++]=o>>>16&255,e[d++]=o>>>8&255,e[d++]=255&o;var p=l/4294967296*1e4&268435455;e[d++]=p>>>8&255,e[d++]=255&p,e[d++]=p>>>24&15|16,e[d++]=p>>>16&255,e[d++]=g>>>8|128,e[d++]=255&g;for(var q=a.node||h,r=0;r<6;++r)e[d+r]=q[r];return b||f(e)}var e=a(13),f=a(12),g=e(),h=[1|g[0],g[1],g[2],g[3],g[4],g[5]],i=16383&(g[6]<<8|g[7]),j=0,k=0;b.exports=d},{12:12,13:13}],15:[function(a,b,c){function d(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"==a?new Array(16):null,a=null),a=a||{};var g=a.random||(a.rng||e)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,b)for(var h=0;h<16;++h)b[d+h]=g[h];return b||f(g)}var e=a(13),f=a(12);b.exports=d},{12:12,13:13}],16:[function(a,b,c){"use strict";function d(a,b,c){var d=c[c.length-1];a===d.element&&(c.pop(),d=c[c.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(a);else if(f===b.length-2){var g=b.pop();e[g]=a}else b.push(a)}c.stringify=function(a){var b=[];b.push({obj:a});for(var c,d,e,f,g,h,i,j,k,l,m,n="";c=b.pop();)if(d=c.obj,e=c.prefix||"",f=c.val||"",n+=e,f)n+=f;else if("object"!=typeof d)n+=void 0===d?null:JSON.stringify(d);else if(null===d)n+="null";else if(Array.isArray(d)){for(b.push({val:"]"}),g=d.length-1;g>=0;g--)h=0===g?"":",",b.push({obj:d[g],prefix:h});b.push({val:"["})}else{i=[];for(j in d)d.hasOwnProperty(j)&&i.push(j);for(b.push({val:"}"}),g=i.length-1;g>=0;g--)k=i[g],l=d[k],m=g>0?",":"",m+=JSON.stringify(k)+":",b.push({obj:l,prefix:m});b.push({val:"{"})}return n},c.parse=function(a){for(var b,c,e,f,g,h,i,j,k,l=[],m=[],n=0;;)if("}"!==(b=a[n++])&&"]"!==b&&void 0!==b)switch(b){case" ":case"\t":case"\n":case":":case",":break;case"n":n+=3,d(null,l,m);break;case"t":n+=3,d(!0,l,m);break;case"f":n+=4,d(!1,l,m);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(c="",n--;;){if(e=a[n++],!/[\d\.\-e\+]/.test(e)){n--;break}c+=e}d(parseFloat(c),l,m);break;case'"':for(f="",g=void 0,h=0;;){if('"'===(i=a[n++])&&("\\"!==g||h%2!=1))break;f+=i,g=i,"\\"===g?h++:h=0}d(JSON.parse('"'+f+'"'),l,m);break;case"[":j={element:[],index:l.length},l.push(j.element),m.push(j);break;case"{":k={element:{},index:l.length},l.push(k.element),m.push(k);break;default:throw new Error("unexpectedly reached end of input: "+b)}else{if(1===l.length)return l.pop();d(l.pop(),l,m)}}},{}],17:[function(a,b,c){(function(c){"use strict";function d(a){return a&&"object"==typeof a&&"default"in a?a.default:a}function e(a){return"undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer||"undefined"!=typeof Blob&&a instanceof Blob}function f(a){if("function"==typeof a.slice)return a.slice(0);var b=new ArrayBuffer(a.byteLength),c=new Uint8Array(b),d=new Uint8Array(a);return c.set(d),b}function g(a){if(a instanceof ArrayBuffer)return f(a);var b=a.size,c=a.type;return"function"==typeof a.slice?a.slice(0,b,c):a.webkitSlice(0,b,c)}function h(a){var b=Object.getPrototypeOf(a);if(null===b)return!0;var c=b.constructor;return"function"==typeof c&&c instanceof c&&oe.call(c)==pe}function i(a){var b,c,d;if(!a||"object"!=typeof a)return a;if(Array.isArray(a)){for(b=[],c=0,d=a.length;c<d;c++)b[c]=i(a[c]);return b}if(a instanceof Date)return a.toISOString();if(e(a))return g(a);if(!h(a))return a;b={};for(c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var f=i(a[c]);void 0!==f&&(b[c]=f)}return b}function j(a){var b=!1;return ge(function(c){if(b)throw new Error("once called more than once");b=!0,a.apply(this,c)})}function k(a){return ge(function(b){b=i(b);var c=this,d="function"==typeof b[b.length-1]&&b.pop(),e=new ne(function(d,e){var f;try{var g=j(function(a,b){a?e(a):d(b)});b.push(g),f=a.apply(c,b),f&&"function"==typeof f.then&&d(f)}catch(a){e(a)}});return d&&e.then(function(a){d(null,a)},d),e})}function l(a,b,c){if(a.constructor.listeners("debug").length){for(var d=["api",a.name,b],e=0;e<c.length-1;e++)d.push(c[e]);a.constructor.emit("debug",d);var f=c[c.length-1];c[c.length-1]=function(c,d){var e=["api",a.name,b];e=e.concat(c?["error",c]:["success",d]),a.constructor.emit("debug",e),f(c,d)}}}function m(a,b){return k(ge(function(c){if(this._closed)return ne.reject(new Error("database is closed"));if(this._destroyed)return ne.reject(new Error("database is destroyed"));var d=this;return l(d,a,c),this.taskqueue.isReady?b.apply(this,c):new ne(function(b,e){d.taskqueue.addTask(function(f){f?e(f):b(d[a].apply(d,c))})})}))}function n(a){return"$"+a}function o(a){return a.substring(1)}function p(){this._store={}}function q(a){if(this._store=new p,a&&Array.isArray(a))for(var b=0,c=a.length;b<c;b++)this.add(a[b])}function r(a,b){for(var c={},d=0,e=b.length;d<e;d++){var f=b[d];f in a&&(c[f]=a[f])}return c}function s(a){return a}function t(a){return[{ok:a}]}function u(a,b,c){function d(){var a=[];m.forEach(function(b){b.docs.forEach(function(c){a.push({id:b.id,docs:[c]})})}),c(null,{results:a})}function e(){++l===k&&d()}function f(a,b,c){m[a]={id:b,docs:c},e()}function g(){if(!(o>=n.length)){var a=Math.min(o+te,n.length),b=n.slice(o,a);h(b,o),o+=b.length}}function h(c,d){c.forEach(function(c,e){var h=d+e,i=j.get(c),k=r(i[0],["atts_since","attachments"]);k.open_revs=i.map(function(a){return a.rev}),k.open_revs=k.open_revs.filter(s);var l=s;0===k.open_revs.length&&(delete k.open_revs,l=t),["revs","attachments","binary","ajax","latest"].forEach(function(a){a in b&&(k[a]=b[a])}),a.get(c,k,function(a,b){var d;d=a?[{error:a}]:l(b),f(h,c,d),g()})})}var i=b.docs,j=new re;i.forEach(function(a){j.has(a.id)?j.get(a.id).push(a):j.set(a.id,[a])});var k=j.size,l=0,m=new Array(k),n=[];j.forEach(function(a,b){n.push(b)});var o=0;g()}function v(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}function w(){return se}function x(a){v()?chrome.storage.onChanged.addListener(function(b){null!=b.db_name&&a.emit(b.dbName.newValue)}):w()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(b){a.emit(b.key)}):window.attachEvent("storage",function(b){a.emit(b.key)}))}function y(){he.EventEmitter.call(this),this._listeners={},x(this)}function z(a){if("undefined"!==console&&a in console){var b=Array.prototype.slice.call(arguments,1);console[a].apply(console,b)}}function A(a,b){return a=parseInt(a,10)||0,b=parseInt(b,10),b!==b||b<=a?b=(a||1)<<1:b+=1,b>6e5&&(a=3e5,b=6e5),~~((b-a)*Math.random()+a)}function B(a){var b=0;return a||(b=2e3),A(a,b)}function C(a,b){z("info","The above "+a+" is totally normal. "+b)}function D(a,b,c){Error.call(this,c),this.status=a,this.name=b,this.message=c,this.error=!0}function E(a,b){function c(b){for(var c in a)"function"!=typeof a[c]&&(this[c]=a[c]);void 0!==b&&(this.reason=b)}return c.prototype=D.prototype,new c(b)}function F(a){if("object"!=typeof a){var b=a;a=Ce,a.data=b}return"error"in a&&"conflict"===a.error&&(a.name="conflict",a.status=409),"name"in a||(a.name=a.error||"unknown"),"status"in a||(a.status=500),"message"in a||(a.message=a.message||a.reason),a}function G(a,b,c){try{return!a(b,c)}catch(a){var d="Filter function threw: "+a.toString();return E(Ge,d)}}function H(a){var b={},c=a.filter&&"function"==typeof a.filter;return b.query=a.query_params,function(d){d.doc||(d.doc={});var e=c&&G(a.filter,d.doc,b);if("object"==typeof e)return e;if(e)return!1;if(a.include_docs){if(!a.attachments)for(var f in d.doc._attachments)d.doc._attachments.hasOwnProperty(f)&&(d.doc._attachments[f].stub=!0)}else delete d.doc;return!0}}function I(a){for(var b=[],c=0,d=a.length;c<d;c++)b=b.concat(a[c]);return b}function J(){}function K(a){var b;if(a?"string"!=typeof a?b=E(ze):/^_/.test(a)&&!/^_(design|local)/.test(a)&&(b=E(Be)):b=E(Ae),b)throw b}function L(a){
return"boolean"==typeof a._remote?a._remote:"function"==typeof a.type&&(z("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===a.type())}function M(a,b){return"listenerCount"in a?a.listenerCount(b):he.EventEmitter.listenerCount(a,b)}function N(a){if(!a)return null;var b=a.split("/");return 2===b.length?b:1===b.length?[a,a]:null}function O(a){var b=N(a);return b?b.join("/"):null}function P(a){for(var b=Qe.exec(a),c={},d=14;d--;){var e=Ne[d],f=b[d]||"",g=-1!==["user","password"].indexOf(e);c[e]=g?decodeURIComponent(f):f}return c[Oe]={},c[Ne[12]].replace(Pe,function(a,b,d){b&&(c[Oe][b]=d)}),c}function Q(a,b){var c=[],d=[];for(var e in b)b.hasOwnProperty(e)&&(c.push(e),d.push(b[e]));return c.push(a),Function.apply(null,c).apply(null,d)}function R(a,b,c){return new ne(function(d,e){a.get(b,function(f,g){if(f){if(404!==f.status)return e(f);g={}}var h=g._rev,i=c(g);if(!i)return d({updated:!1,rev:h});i._id=b,i._rev=h,d(S(a,i,c))})})}function S(a,b,c){return a.put(b).then(function(a){return{updated:!0,rev:a.rev}},function(d){if(409!==d.status)throw d;return R(a,b._id,c)})}function T(){return ee.v4().replace(/-/g,"").toLowerCase()}function U(a){for(var b,c,d,e,f=a.rev_tree.slice();e=f.pop();){var g=e.ids,h=g[2],i=e.pos;if(h.length)for(var j=0,k=h.length;j<k;j++)f.push({pos:i+1,ids:h[j]});else{var l=!!g[1].deleted,m=g[0];b&&!(d!==l?d:c!==i?c<i:b<m)||(b=m,c=i,d=l)}}return c+"-"+b}function V(a,b){for(var c,d=a.slice();c=d.pop();)for(var e=c.pos,f=c.ids,g=f[2],h=b(0===g.length,e,f[0],c.ctx,f[1]),i=0,j=g.length;i<j;i++)d.push({pos:e+1,ids:g[i],ctx:h})}function W(a,b){return a.pos-b.pos}function X(a){var b=[];V(a,function(a,c,d,e,f){a&&b.push({rev:c+"-"+d,pos:c,opts:f})}),b.sort(W).reverse();for(var c=0,d=b.length;c<d;c++)delete b[c].pos;return b}function Y(a){for(var b=U(a),c=X(a.rev_tree),d=[],e=0,f=c.length;e<f;e++){var g=c[e];g.rev===b||g.opts.deleted||d.push(g.rev)}return d}function Z(a){var b=[];return V(a.rev_tree,function(a,c,d,e,f){"available"!==f.status||a||(b.push(c+"-"+d),f.status="missing")}),b}function $(a){for(var b,c=[],d=a.slice();b=d.pop();){var e=b.pos,f=b.ids,g=f[0],h=f[1],i=f[2],j=0===i.length,k=b.history?b.history.slice():[];k.push({id:g,opts:h}),j&&c.push({pos:e+1-k.length,ids:k});for(var l=0,m=i.length;l<m;l++)d.push({pos:e+1,ids:i[l],history:k})}return c.reverse()}function _(a,b){return a.pos-b.pos}function aa(a,b,c){for(var d,e=0,f=a.length;e<f;)d=e+f>>>1,c(a[d],b)<0?e=d+1:f=d;return e}function ba(a,b,c){var d=aa(a,b,c);a.splice(d,0,b)}function ca(a,b){for(var c,d,e=b,f=a.length;e<f;e++){var g=a[e],h=[g.id,g.opts,[]];d?(d[2].push(h),d=h):c=d=h}return c}function da(a,b){return a[0]<b[0]?-1:1}function ea(a,b){for(var c=[{tree1:a,tree2:b}],d=!1;c.length>0;){var e=c.pop(),f=e.tree1,g=e.tree2;(f[1].status||g[1].status)&&(f[1].status="available"===f[1].status||"available"===g[1].status?"available":"missing");for(var h=0;h<g[2].length;h++)if(f[2][0]){for(var i=!1,j=0;j<f[2].length;j++)f[2][j][0]===g[2][h][0]&&(c.push({tree1:f[2][j],tree2:g[2][h]}),i=!0);i||(d="new_branch",ba(f[2],g[2][h],da))}else d="new_leaf",f[2][0]=g[2][h]}return{conflicts:d,tree:a}}function fa(a,b,c){var d,e=[],f=!1,g=!1;if(!a.length)return{tree:[b],conflicts:"new_leaf"};for(var h=0,i=a.length;h<i;h++){var j=a[h];if(j.pos===b.pos&&j.ids[0]===b.ids[0])d=ea(j.ids,b.ids),e.push({pos:j.pos,ids:d.tree}),f=f||d.conflicts,g=!0;else if(!0!==c){var k=j.pos<b.pos?j:b,l=j.pos<b.pos?b:j,m=l.pos-k.pos,n=[],o=[];for(o.push({ids:k.ids,diff:m,parent:null,parentIdx:null});o.length>0;){var p=o.pop();if(0!==p.diff)for(var q=p.ids[2],r=0,s=q.length;r<s;r++)o.push({ids:q[r],diff:p.diff-1,parent:p.ids,parentIdx:r});else p.ids[0]===l.ids[0]&&n.push(p)}var t=n[0];t?(d=ea(t.ids,l.ids),t.parent[2][t.parentIdx]=d.tree,e.push({pos:k.pos,ids:k.ids}),f=f||d.conflicts,g=!0):e.push(j)}else e.push(j)}return g||e.push(b),e.sort(_),{tree:e,conflicts:f||"internal_node"}}function ga(a,b){for(var c,d,e=$(a),f=0,g=e.length;f<g;f++){var h,i=e[f],j=i.ids;if(j.length>b){c||(c={});var k=j.length-b;h={pos:i.pos+k,ids:ca(j,k)};for(var l=0;l<k;l++){var m=i.pos+l+"-"+j[l].id;c[m]=!0}}else h={pos:i.pos,ids:ca(j,0)};d=d?fa(d,h,!0).tree:[h]}return c&&V(d,function(a,b,d){delete c[b+"-"+d]}),{tree:d,revs:c?Object.keys(c):[]}}function ha(a,b,c){var d=fa(a,b),e=ga(d.tree,c);return{tree:e.tree,stemmedRevs:e.revs,conflicts:d.conflicts}}function ia(a,b){for(var c,d=a.slice(),e=b.split("-"),f=parseInt(e[0],10),g=e[1];c=d.pop();){if(c.pos===f&&c.ids[0]===g)return!0;for(var h=c.ids[2],i=0,j=h.length;i<j;i++)d.push({pos:c.pos+1,ids:h[i]})}return!1}function ja(a){return a.ids}function ka(a,b){b||(b=U(a));for(var c,d=b.substring(b.indexOf("-")+1),e=a.rev_tree.map(ja);c=e.pop();){if(c[0]===d)return!!c[1].deleted;e=e.concat(c[2])}}function la(a){return/^_local/.test(a)}function ma(a,b){for(var c,d=b.rev_tree.slice();c=d.pop();){var e=c.pos,f=c.ids,g=f[0],h=f[1],i=f[2],j=0===i.length,k=c.history?c.history.slice():[];if(k.push({id:g,pos:e,opts:h}),j)for(var l=0,m=k.length;l<m;l++){var n=k[l],o=n.pos+"-"+n.id;if(o===a)return e+"-"+g}for(var p=0,q=i.length;p<q;p++)d.push({pos:e+1,ids:i[p],history:k})}throw new Error("Unable to resolve latest revision for id "+b.id+", rev "+a)}function na(a,b){try{a.emit("change",b)}catch(a){z("error",'Error in .on("change", function):',a)}}function oa(a,b,c){function d(){e.cancel()}he.EventEmitter.call(this);var e=this;this.db=a,b=b?i(b):{};var f=b.complete=j(function(b,c){b?M(e,"error")>0&&e.emit("error",b):e.emit("complete",c),e.removeAllListeners(),a.removeListener("destroyed",d)});c&&(e.on("complete",function(a){c(null,a)}),e.on("error",c)),a.once("destroyed",d),b.onChange=function(a){e.isCancelled||na(e,a)};var g=new ne(function(a,c){b.complete=function(b,d){b?c(b):a(d)}});e.once("cancel",function(){a.removeListener("destroyed",d),b.complete(null,{status:"cancelled"})}),this.then=g.then.bind(g),this.catch=g.catch.bind(g),this.then(function(a){f(null,a)},f),a.taskqueue.isReady?e.validateChanges(b):a.taskqueue.addTask(function(a){a?b.complete(a):e.isCancelled?e.emit("cancel"):e.validateChanges(b)})}function pa(a,b,c){var d=[{rev:a._rev}];"all_docs"===c.style&&(d=X(b.rev_tree).map(function(a){return{rev:a.rev}}));var e={id:b.id,changes:d,doc:a};return ka(b,a._rev)&&(e.deleted=!0),c.conflicts&&(e.doc._conflicts=Y(b),e.doc._conflicts.length||delete e.doc._conflicts),e}function qa(a,b){return a<b?-1:a>b?1:0}function ra(a,b){return function(c,d){c||d[0]&&d[0].error?(c=c||d[0],c.docId=b,a(c)):a(null,d.length?d[0]:d)}}function sa(a){for(var b=0;b<a.length;b++){var c=a[b];if(c._deleted)delete c._attachments;else if(c._attachments)for(var d=Object.keys(c._attachments),e=0;e<d.length;e++){var f=d[e];c._attachments[f]=r(c._attachments[f],["data","digest","content_type","length","revpos","stub"])}}}function ta(a,b){var c=qa(a._id,b._id);return 0!==c?c:qa(a._revisions?a._revisions.start:0,b._revisions?b._revisions.start:0)}function ua(a){var b={},c=[];return V(a,function(a,d,e,f){var g=d+"-"+e;return a&&(b[g]=0),void 0!==f&&c.push({from:f,to:g}),g}),c.reverse(),c.forEach(function(a){void 0===b[a.from]?b[a.from]=1+b[a.to]:b[a.from]=Math.min(b[a.from],1+b[a.to])}),b}function va(a,b,c){var d="limit"in b?b.keys.slice(b.skip,b.limit+b.skip):b.skip>0?b.keys.slice(b.skip):b.keys;if(b.descending&&d.reverse(),!d.length)return a._allDocs({limit:0},c);var e={offset:b.skip};return ne.all(d.map(function(c){var d=ve({key:c,deleted:"ok"},b);return["limit","skip","keys"].forEach(function(a){delete d[a]}),new ne(function(b,f){a._allDocs(d,function(a,d){if(a)return f(a);e.total_rows=d.total_rows,b(d.rows[0]||{key:c,error:"not_found"})})})})).then(function(a){return e.rows=a,e})}function wa(a){var b=a._compactionQueue[0],c=b.opts,d=b.callback;a.get("_local/compaction").catch(function(){return!1}).then(function(b){b&&b.last_seq&&(c.last_seq=b.last_seq),a._compact(c,function(b,c){b?d(b):d(null,c),je(function(){a._compactionQueue.shift(),a._compactionQueue.length&&wa(a)})})})}function xa(a){return"_"===a.charAt(0)&&a+" is not a valid attachment name, attachment names cannot start with '_'"}function ya(){he.EventEmitter.call(this)}function za(){this.isReady=!1,this.failed=!1,this.queue=[]}function Aa(a,b){var c=a.match(/([a-z-]*):\/\/(.*)/);if(c)return{name:/https?/.test(c[1])?c[1]+"://"+c[2]:c[2],adapter:c[1]};var d=Ca.adapters,e=Ca.preferredAdapters,f=Ca.prefix,g=b.adapter;if(!g)for(var h=0;h<e.length;++h){g=e[h];{if(!("idb"===g&&"websql"in d&&w()&&localStorage["_pouch__websqldb_"+f+a]))break;z("log",'PouchDB is downgrading "'+a+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.')}}var i=d[g];return{name:i&&"use_prefix"in i&&!i.use_prefix?a:f+a,adapter:g}}function Ba(a){function b(b){a.removeListener("closed",c),b||a.constructor.emit("destroyed",a.name)}function c(){a.removeListener("destroyed",b),a.constructor.emit("unref",a)}a.once("destroyed",b),a.once("closed",c),a.constructor.emit("ref",a)}function Ca(a,b){if(!(this instanceof Ca))return new Ca(a,b);var c=this;if(b=b||{},a&&"object"==typeof a&&(b=a,a=b.name,delete b.name),this.__opts=b=i(b),c.auto_compaction=b.auto_compaction,c.prefix=Ca.prefix,"string"!=typeof a)throw new Error("Missing/invalid DB name");var d=(b.prefix||"")+a,e=Aa(d,b);if(b.name=e.name,b.adapter=b.adapter||e.adapter,c.name=a,c._adapter=b.adapter,Ca.emit("debug",["adapter","Picked adapter: ",b.adapter]),!Ca.adapters[b.adapter]||!Ca.adapters[b.adapter].valid())throw new Error("Invalid Adapter: "+b.adapter);ya.call(c),c.taskqueue=new za,c.adapter=b.adapter,Ca.adapters[b.adapter].call(c,b,function(a){if(a)return c.taskqueue.fail(a);Ba(c),c.emit("created",c),Ca.emit("created",c.name),c.taskqueue.ready(c)})}function Da(a){a.debug=ke;var b={};a.on("debug",function(a){var c=a[0],d=a.slice(1);b[c]||(b[c]=ke("pouchdb:"+c)),b[c].apply(null,d)})}function Ea(a,b){for(var c=a,d=0,e=b.length;d<e;d++){if(!(c=c[b[d]]))break}return c}function Fa(a,b){return a<b?-1:a>b?1:0}function Ga(a){for(var b=[],c="",d=0,e=a.length;d<e;d++){var f=a[d];"."===f?d>0&&"\\"===a[d-1]?c=c.substring(0,c.length-1)+".":(b.push(c),c=""):c+=f}return b.push(c),b}function Ha(a){return Te.indexOf(a)>-1}function Ia(a){return Object.keys(a)[0]}function Ja(a){return a[Ia(a)]}function Ka(a){var b={};return a.forEach(function(a){Object.keys(a).forEach(function(c){var d=a[c];if("object"!=typeof d&&(d={$eq:d}),Ha(c))d instanceof Array?b[c]=d.map(function(a){return Ka([a])}):b[c]=Ka([d]);else{var e=b[c]=b[c]||{};Object.keys(d).forEach(function(a){var b=d[a];return"$gt"===a||"$gte"===a?La(a,b,e):"$lt"===a||"$lte"===a?Ma(a,b,e):"$ne"===a?Na(b,e):"$eq"===a?Oa(b,e):void(e[a]=b)})}})}),b}function La(a,b,c){void 0===c.$eq&&(void 0!==c.$gte?"$gte"===a?b>c.$gte&&(c.$gte=b):b>=c.$gte&&(delete c.$gte,c.$gt=b):void 0!==c.$gt?"$gte"===a?b>c.$gt&&(delete c.$gt,c.$gte=b):b>c.$gt&&(c.$gt=b):c[a]=b)}function Ma(a,b,c){void 0===c.$eq&&(void 0!==c.$lte?"$lte"===a?b<c.$lte&&(c.$lte=b):b<=c.$lte&&(delete c.$lte,c.$lt=b):void 0!==c.$lt?"$lte"===a?b<c.$lt&&(delete c.$lt,c.$lte=b):b<c.$lt&&(c.$lt=b):c[a]=b)}function Na(a,b){"$ne"in b?b.$ne.push(a):b.$ne=[a]}function Oa(a,b){delete b.$gt,delete b.$gte,delete b.$lt,delete b.$lte,delete b.$ne,b.$eq=a}function Pa(a){var b=i(a),c=!1;"$and"in b&&(b=Ka(b.$and),c=!0),["$or","$nor"].forEach(function(a){a in b&&b[a].forEach(function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=b[c],e=a[d];"object"==typeof e&&null!==e||(a[d]={$eq:e})}})}),"$not"in b&&(b.$not=Ka([b.$not]));for(var d=Object.keys(b),e=0;e<d.length;e++){var f=d[e],g=b[f];"object"!=typeof g||null===g?g={$eq:g}:"$ne"in g&&!c&&(g.$ne=[g.$ne]),b[f]=g}return b}function Qa(a,b,c){for(var d="",e=c-a.length;d.length<e;)d+=b;return d}function Ra(a,b,c){return Qa(a,b,c)+a}function Sa(a,b){if(a===b)return 0;a=Ta(a),b=Ta(b);var c=ab(a),d=ab(b);if(c-d!=0)return c-d;switch(typeof a){case"number":return a-b;case"boolean":return a<b?-1:1;case"string":return $a(a,b)}return Array.isArray(a)?Za(a,b):_a(a,b)}function Ta(a){switch(typeof a){case"undefined":return null;case"number":return a===1/0||a===-1/0||isNaN(a)?null:a;case"object":var b=a;if(Array.isArray(a)){var c=a.length;a=new Array(c);for(var d=0;d<c;d++)a[d]=Ta(b[d])}else{if(a instanceof Date)return a.toJSON();if(null!==a){a={};for(var e in b)if(b.hasOwnProperty(e)){var f=b[e];void 0!==f&&(a[e]=Ta(f))}}}}return a}function Ua(a){if(null!==a)switch(typeof a){case"boolean":return a?1:0;case"number":return bb(a);case"string":return a.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var b=Array.isArray(a),c=b?a:Object.keys(a),d=-1,e=c.length,f="";if(b)for(;++d<e;)f+=Va(c[d]);else for(;++d<e;){var g=c[d];f+=Va(g)+Va(a[g])}return f}return""}function Va(a){return a=Ta(a),ab(a)+We+Ua(a)+"\0"}function Wa(a,b){var c,d=b;if("1"===a[b])c=0,b++;else{var e="0"===a[b];b++;var f="",g=a.substring(b,b+Ve),h=parseInt(g,10)+Ue;for(e&&(h=-h),b+=Ve;;){var i=a[b];if("\0"===i)break;f+=i,b++}f=f.split("."),c=1===f.length?parseInt(f,10):parseFloat(f[0]+"."+f[1]),e&&(c-=10),0!==h&&(c=parseFloat(c+"e"+h))}return{num:c,length:b-d}}function Xa(a,b){var c=a.pop();if(b.length){var d=b[b.length-1];c===d.element&&(b.pop(),d=b[b.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(c);else if(f===a.length-2){var g=a.pop();e[g]=c}else a.push(c)}}function Ya(a){for(var b=[],c=[],d=0;;){var e=a[d++];if("\0"!==e)switch(e){case"1":b.push(null);break;case"2":b.push("1"===a[d]),d++;break;case"3":var f=Wa(a,d);b.push(f.num),d+=f.length;break;case"4":for(var g="";;){var h=a[d];if("\0"===h)break;g+=h,d++}g=g.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),b.push(g);break;case"5":var i={element:[],index:b.length};b.push(i.element),c.push(i);break;case"6":var j={element:{},index:b.length};b.push(j.element),c.push(j);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+e)}else{if(1===b.length)return b.pop();Xa(b,c)}}}function Za(a,b){for(var c=Math.min(a.length,b.length),d=0;d<c;d++){var e=Sa(a[d],b[d]);if(0!==e)return e}return a.length===b.length?0:a.length>b.length?1:-1}function $a(a,b){return a===b?0:a>b?1:-1}function _a(a,b){for(var c=Object.keys(a),d=Object.keys(b),e=Math.min(c.length,d.length),f=0;f<e;f++){var g=Sa(c[f],d[f]);if(0!==g)return g;if(0!==(g=Sa(a[c[f]],b[d[f]])))return g}return c.length===d.length?0:c.length>d.length?1:-1}function ab(a){var b=["boolean","number","string","object"],c=b.indexOf(typeof a);return~c?null===a?1:Array.isArray(a)?5:c<3?c+2:c+3:Array.isArray(a)?5:void 0}function bb(a){if(0===a)return"1";var b=a.toExponential().split(/e\+?/),c=parseInt(b[1],10),d=a<0,e=d?"0":"2",f=(d?-c:c)-Ue,g=Ra(f.toString(),"0",Ve);e+=We+g;var h=Math.abs(parseFloat(b[0]));d&&(h=10-h);var i=h.toFixed(20);return i=i.replace(/\.?0+$/,""),e+=We+i}function cb(a){function b(b){return a.map(function(a){var c=Ia(a),d=Ga(c);return Ea(b,d)})}return function(a,c){var d=b(a.doc),e=b(c.doc),f=Sa(d,e);return 0!==f?f:Fa(a.doc._id,c.doc._id)}}function db(a,b,c){if(a=a.filter(function(a){return eb(a.doc,b.selector,c)}),b.sort){var d=cb(b.sort);a=a.sort(d),"string"!=typeof b.sort[0]&&"desc"===Ja(b.sort[0])&&(a=a.reverse())}if("limit"in b||"skip"in b){var e=b.skip||0,f=("limit"in b?b.limit:a.length)+e;a=a.slice(e,f)}return a}function eb(a,b,c){return c.every(function(c){var d=b[c],e=Ga(c),f=Ea(a,e);return Ha(c)?gb(c,d,a):fb(d,a,e,f)})}function fb(a,b,c,d){return!a||Object.keys(a).every(function(e){var f=a[e];return hb(e,b,f,c,d)})}function gb(a,b,c){return"$or"===a?b.some(function(a){return eb(c,a,Object.keys(a))}):"$not"===a?!eb(c,b,Object.keys(b)):!b.find(function(a){return eb(c,a,Object.keys(a))})}function hb(a,b,c,d,e){if(!Xe[a])throw new Error('unknown operator "'+a+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Xe[a](b,c,d,e)}function ib(a){return void 0!==a&&null!==a}function jb(a){return void 0!==a}function kb(a,b){var c=b[0],d=b[1];if(0===c)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(c,10)!==c)throw new Error("Divisor is not an integer");if(parseInt(d,10)!==d)throw new Error("Modulus is not an integer");return parseInt(a,10)===a&&a%c===d}function lb(a,b){return b.some(function(b){return a instanceof Array?a.indexOf(b)>-1:a===b})}function mb(a,b){return b.every(function(b){return a.indexOf(b)>-1})}function nb(a,b){return a.length===b}function ob(a,b){return new RegExp(b).test(a)}function pb(a,b){switch(b){case"null":return null===a;case"boolean":return"boolean"==typeof a;case"number":return"number"==typeof a;case"string":return"string"==typeof a;case"array":return a instanceof Array;case"object":return"[object Object]"==={}.toString.call(a)}throw new Error(b+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}function qb(a,b){if("object"!=typeof b)throw new Error("Selector error: expected a JSON object");b=Pa(b);var c={doc:a},d=db([c],{selector:b},Object.keys(b));return d&&1===d.length}function rb(a){return Q('"use strict";\nreturn '+a+";",{})}function sb(a){return Q(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+a+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{})}function tb(a,b){if(a.selector&&a.filter&&"_selector"!==a.filter){var c="string"==typeof a.filter?a.filter:"function";return b(new Error('selector invalid for filter "'+c+'"'))}b()}function ub(a){a.view&&!a.filter&&(a.filter="_view"),a.selector&&!a.filter&&(a.filter="_selector"),a.filter&&"string"==typeof a.filter&&("_view"===a.filter?a.view=O(a.view):a.filter=O(a.filter))}function vb(a,b){return b.filter&&"string"==typeof b.filter&&!b.doc_ids&&!L(a.db)}function wb(a,b){var c=b.complete;if("_view"===b.filter){if(!b.view||"string"!=typeof b.view){var d=E(Ge,"`view` filter parameter not found or invalid.");return c(d)}var e=N(b.view);a.db.get("_design/"+e[0],function(d,f){if(a.isCancelled)return c(null,{status:"cancelled"});if(d)return c(F(d));var g=f&&f.views&&f.views[e[1]]&&f.views[e[1]].map;if(!g)return c(E(xe,f.views?"missing json key: "+e[1]:"missing json key: views"));b.filter=sb(g),a.doChanges(b)})}else if(b.selector)b.filter=function(a){return qb(a,b.selector)},a.doChanges(b);else{var f=N(b.filter);a.db.get("_design/"+f[0],function(d,e){if(a.isCancelled)return c(null,{status:"cancelled"});if(d)return c(F(d));var g=e&&e.filters&&e.filters[f[1]];if(!g)return c(E(xe,e&&e.filters?"missing json key: "+f[1]:"missing json key: filters"));b.filter=rb(g),a.doChanges(b)})}}function xb(a){a._changesFilterPlugin={validate:tb,normalize:ub,shouldFilter:vb,filter:wb}}function yb(a){return a.reduce(function(a,b){return a[b]=!0,a},{})}function zb(a){if(!/^\d+-./.test(a))return E(Ke);var b=a.indexOf("-"),c=a.substring(0,b),d=a.substring(b+1);return{prefix:parseInt(c,10),id:d}}function Ab(a,b){for(var c=a.start-a.ids.length+1,d=a.ids,e=[d[0],b,[]],f=1,g=d.length;f<g;f++)e=[d[f],{status:"missing"},[e]];return[{pos:c,ids:e}]}function Bb(a,b){var c,d,e,f={status:"available"};if(a._deleted&&(f.deleted=!0),b)if(a._id||(a._id=Re()),d=T(),a._rev){if(e=zb(a._rev),e.error)return e;a._rev_tree=[{pos:e.prefix,ids:[e.id,{status:"missing"},[[d,f,[]]]]}],c=e.prefix+1}else a._rev_tree=[{pos:1,ids:[d,f,[]]}],c=1;else if(a._revisions&&(a._rev_tree=Ab(a._revisions,f),c=a._revisions.start,d=a._revisions.ids[0]),!a._rev_tree){if(e=zb(a._rev),e.error)return e;c=e.prefix,d=e.id,a._rev_tree=[{pos:c,ids:[d,f,[]]}]}K(a._id),a._rev=c+"-"+d;var g={metadata:{},data:{}};for(var h in a)if(Object.prototype.hasOwnProperty.call(a,h)){var i="_"===h[0];if(i&&!Ze[h]){var j=E(Fe,h);throw j.message=Fe.message+": "+h,j}i&&!$e[h]?g.metadata[h.slice(1)]=a[h]:g.data[h]=a[h]}return g}function Cb(a,b){a=a||[],b=b||{};try{return new Blob(a,b)}catch(f){if("TypeError"!==f.name)throw f;for(var c="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,d=new c,e=0;e<a.length;e+=1)d.append(a[e]);return d.getBlob(b.type)}}function Db(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c}function Eb(a,b){return Cb([Db(a)],{type:b})}function Fb(a,b){return Eb(_e(a),b)}function Gb(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;e<d;e++)b+=String.fromCharCode(c[e]);return b}function Hb(a,b){if("undefined"==typeof FileReader)return b(Gb((new FileReaderSync).readAsArrayBuffer(a)));var c=new FileReader,d="function"==typeof c.readAsBinaryString;c.onloadend=function(a){var c=a.target.result||"";if(d)return b(c);b(Gb(c))},d?c.readAsBinaryString(a):c.readAsArrayBuffer(a)}function Ib(a,b){Hb(a,function(a){b(a)})}function Jb(a,b){Ib(a,function(a){b(af(a))})}function Kb(a,b){if("undefined"==typeof FileReader)return b((new FileReaderSync).readAsArrayBuffer(a));var c=new FileReader;c.onloadend=function(a){var c=a.target.result||new ArrayBuffer(0);b(c)},c.readAsArrayBuffer(a)}function Lb(a){return af(a)}function Mb(a,b,c){return a.webkitSlice?a.webkitSlice(b,c):a.slice(b,c)}function Nb(a,b,c,d,e){(c>0||d<b.size)&&(b=Mb(b,c,d)),Kb(b,function(b){a.append(b),e()})}function Ob(a,b,c,d,e){(c>0||d<b.length)&&(b=b.substring(c,d)),a.appendBinary(b),e()}function Pb(a,b){function c(){bf(e)}function d(){var a=k.end(!0),c=Lb(a);b(c),k.destroy()}function e(){var b=j*h,e=b+h;j++,j<i?l(k,a,b,e,c):l(k,a,b,e,d)}var f="string"==typeof a,g=f?a.length:a.size,h=Math.min(cf,g),i=Math.ceil(g/h),j=0,k=f?new le:new le.ArrayBuffer,l=f?Ob:Nb;e()}function Qb(a){return le.hash(a)}function Rb(a){try{return _e(a)}catch(a){var b=E(De,"Attachment is not a valid base64 string");return{error:b}}}function Sb(a,b,c){var d=Rb(a.data);if(d.error)return c(d.error);a.length=d.length,a.data="blob"===b?Eb(d,a.content_type):"base64"===b?af(d):d,Pb(d,function(b){a.digest="md5-"+b,c()})}function Tb(a,b,c){Pb(a.data,function(d){a.digest="md5-"+d,a.length=a.data.size||a.data.length||0,"binary"===b?Ib(a.data,function(b){a.data=b,c()}):"base64"===b?Jb(a.data,function(b){a.data=b,c()}):c()})}function Ub(a,b,c){if(a.stub)return c();"string"==typeof a.data?Sb(a,b,c):Tb(a,b,c)}function Vb(a,b,c){function d(){f++,a.length===f&&(e?c(e):c())}if(!a.length)return c();var e,f=0;a.forEach(function(a){function c(a){e=a,++g===f.length&&d()}var f=a.data&&a.data._attachments?Object.keys(a.data._attachments):[],g=0;if(!f.length)return d();for(var h in a.data._attachments)a.data._attachments.hasOwnProperty(h)&&Ub(a.data._attachments[h],b,c)})}function Wb(a,b,c,d,e,f,g,h){if(ia(b.rev_tree,c.metadata.rev))return d[e]=c,f();var i=b.winningRev||U(b),j="deleted"in b?b.deleted:ka(b,i),k="deleted"in c.metadata?c.metadata.deleted:ka(c.metadata),l=/^1-/.test(c.metadata.rev);if(j&&!k&&h&&l){var m=c.data;m._rev=i,m._id=c.metadata.id,c=Bb(m,h)}var n=ha(b.rev_tree,c.metadata.rev_tree[0],a);if(h&&(j&&k&&"new_leaf"!==n.conflicts||!j&&"new_leaf"!==n.conflicts||j&&!k&&"new_branch"===n.conflicts)){var o=E(ye);return d[e]=o,f()}var p=c.metadata.rev;c.metadata.rev_tree=n.tree,c.stemmedRevs=n.stemmedRevs||[],b.rev_map&&(c.metadata.rev_map=b.rev_map);var q,r=U(c.metadata),s=ka(c.metadata,r),t=j===s?0:j<s?-1:1;q=p===r?s:ka(c.metadata,p),g(c,r,s,q,!0,t,e,f)}function Xb(a){return"missing"===a.metadata.rev_tree[0].ids[1].status}function Yb(a,b,c,d,e,f,g,h,i){function j(a,b,c){var d=U(a.metadata),e=ka(a.metadata,d);if("was_delete"in h&&e)return f[b]=E(xe,"deleted"),c();if(l&&Xb(a)){var i=E(ye);return f[b]=i,c()}g(a,d,e,e,!1,e?0:1,b,c)}function k(){++n===o&&i&&i()}a=a||1e3;var l=h.new_edits,m=new re,n=0,o=b.length;b.forEach(function(a,b){if(a._id&&la(a._id)){var d=a._deleted?"_removeLocal":"_putLocal";return void c[d](a,{ctx:e},function(a,c){f[b]=a||c,k()})}var g=a.metadata.id;m.has(g)?(o--,m.get(g).push([a,b])):m.set(g,[[a,b]])}),m.forEach(function(b,c){function e(){++i<b.length?h():k()}function h(){var h=b[i],k=h[0],m=h[1];if(d.has(c))Wb(a,d.get(c),k,f,m,e,g,l);else{var n=ha([],k.metadata.rev_tree[0],a);k.metadata.rev_tree=n.tree,k.stemmedRevs=n.stemmedRevs||[],j(k,m,e)}}var i=0;h()})}function Zb(a){try{return JSON.parse(a)}catch(b){return me.parse(a)}}function $b(a){try{return JSON.stringify(a)}catch(b){return me.stringify(a)}}function _b(a){return function(b){var c="unknown_error";b.target&&b.target.error&&(c=b.target.error.name||b.target.error.message),a(E(Ie,c,b.type))}}function ac(a,b,c){return{data:$b(a),winningRev:b,deletedOrLocal:c?"1":"0",seq:a.seq,id:a.id}}function bc(a){if(!a)return null;var b=Zb(a.data);return b.winningRev=a.winningRev,b.deleted="1"===a.deletedOrLocal,b.seq=a.seq,b}function cc(a){if(!a)return a;var b=a._doc_id_rev.lastIndexOf(":");return a._id=a._doc_id_rev.substring(0,b-1),a._rev=a._doc_id_rev.substring(b+1),delete a._doc_id_rev,a}function dc(a,b,c,d){c?d(a?"string"!=typeof a?a:Fb(a,b):Cb([""],{type:b})):a?"string"!=typeof a?Hb(a,function(a){d(af(a))}):d(a):d("")}function ec(a,b,c,d){function e(){++h===g.length&&d&&d()}function f(a,b){var d=a._attachments[b],f=d.digest;c.objectStore(gf).get(f).onsuccess=function(a){d.body=a.target.result.body,e()}}var g=Object.keys(a._attachments||{});if(!g.length)return d&&d();var h=0;g.forEach(function(c){b.attachments&&b.include_docs?f(a,c):(a._attachments[c].stub=!0,e())})}function fc(a,b){return ne.all(a.map(function(a){if(a.doc&&a.doc._attachments){var c=Object.keys(a.doc._attachments);return ne.all(c.map(function(c){var d=a.doc._attachments[c];if("body"in d){var e=d.body,f=d.content_type;return new ne(function(g){dc(e,f,b,function(b){a.doc._attachments[c]=ve(r(d,["digest","content_type"]),{data:b}),g()})})}}))}}))}function gc(a,b,c){function d(){--j||e()}function e(){f.length&&f.forEach(function(a){i.index("digestSeq").count(IDBKeyRange.bound(a+"::",a+"::￿",!1,!1)).onsuccess=function(b){b.target.result||h.delete(a)}})}var f=[],g=c.objectStore(ff),h=c.objectStore(gf),i=c.objectStore(hf),j=a.length;a.forEach(function(a){var c=g.index("_doc_id_rev"),e=b+"::"+a;c.getKey(e).onsuccess=function(a){var b=a.target.result;if("number"!=typeof b)return d();g.delete(b),i.index("seq").openCursor(IDBKeyRange.only(b)).onsuccess=function(a){var b=a.target.result;if(b){var c=b.value.digestSeq.split("::")[0];f.push(c),i.delete(b.primaryKey),b.continue()}else d()}}})}function hc(a,b,c){try{return{txn:a.transaction(b,c)}}catch(a){return{error:a}}}function ic(a,b,c,d,e,f){function g(){var a=[ef,ff,gf,kf,hf,jf],b=hc(e,a,"readwrite");if(b.error)return f(b.error);t=b.txn,t.onabort=_b(f),t.ontimeout=_b(f),t.oncomplete=l,u=t.objectStore(ef),v=t.objectStore(ff),w=t.objectStore(gf),x=t.objectStore(hf),y=t.objectStore(jf),y.get(jf).onsuccess=function(a){A=a.target.result,j()},n(function(a){if(a)return K=!0,f(a);k()})}function h(){G=!0,j()}function i(){Yb(a.revs_limit,B,d,J,t,I,o,c,h)}function j(){A&&G&&(A.docCount+=H,y.put(A))}function k(){function a(){++c===B.length&&i()}function b(b){var c=bc(b.target.result);c&&J.set(c.id,c),a()}if(B.length)for(var c=0,d=0,e=B.length;d<e;d++){var f=B[d];if(f._id&&la(f._id))a();else{var g=u.get(f.metadata.id);g.onsuccess=b}}}function l(){K||(mf.notify(d._meta.name),f(null,I))}function m(a,b){w.get(a).onsuccess=function(c){if(c.target.result)b();else{var d=E(Le,"unknown stub attachment with digest "+a);d.status=412,b(d)}}}function n(a){function b(){++e===c.length&&a(d)}var c=[];if(B.forEach(function(a){a.data&&a.data._attachments&&Object.keys(a.data._attachments).forEach(function(b){var d=a.data._attachments[b];d.stub&&c.push(d.digest)})}),!c.length)return a();var d,e=0;c.forEach(function(a){m(a,function(a){a&&!d&&(d=a),b()})})}function o(a,b,c,d,e,f,g,h){a.metadata.winningRev=b,a.metadata.deleted=c;var i=a.data;if(i._id=a.metadata.id,i._rev=a.metadata.rev,d&&(i._deleted=!0),i._attachments&&Object.keys(i._attachments).length)return q(a,b,c,e,g,h);H+=f,j(),p(a,b,c,e,g,h)}function p(a,b,c,e,f,g){function h(f){var g=a.stemmedRevs||[];e&&d.auto_compaction&&(g=g.concat(Z(a.metadata))),g&&g.length&&gc(g,a.metadata.id,t),l.seq=f.target.result;var h=ac(l,b,c);u.put(h).onsuccess=j}function i(a){a.preventDefault(),a.stopPropagation(),v.index("_doc_id_rev").getKey(k._doc_id_rev).onsuccess=function(a){v.put(k,a.target.result).onsuccess=h}}function j(){I[f]={ok:!0,id:l.id,rev:l.rev},J.set(a.metadata.id,a.metadata),r(a,l.seq,g)}var k=a.data,l=a.metadata;k._doc_id_rev=l.id+"::"+l.rev,delete k._id,delete k._rev;var m=v.put(k);m.onsuccess=h,m.onerror=i}function q(a,b,c,d,e,f){function g(){j===k.length&&p(a,b,c,d,e,f)}function h(){j++,g()}var i=a.data,j=0,k=Object.keys(i._attachments);k.forEach(function(c){var d=a.data._attachments[c];if(d.stub)j++,g();else{var e=d.data;delete d.data,d.revpos=parseInt(b,10);s(d.digest,e,h)}})}function r(a,b,c){function d(){++e===f.length&&c()}var e=0,f=Object.keys(a.data._attachments||{});if(!f.length)return c();for(var g=0;g<f.length;g++)!function(c){var e=a.data._attachments[c].digest,f=x.put({seq:b,digestSeq:e+"::"+b});f.onsuccess=d,f.onerror=function(a){a.preventDefault(),a.stopPropagation(),d()}}(f[g])}function s(a,b,c){w.count(a).onsuccess=function(d){if(d.target.result)return c();var e={digest:a,body:b};w.put(e).onsuccess=c}}for(var t,u,v,w,x,y,z,A,B=b.docs,C=0,D=B.length;C<D;C++){var F=B[C];F._id&&la(F._id)||(F=B[C]=Bb(F,c.new_edits),F.error&&!z&&(z=F))}if(z)return f(z);var G=!1,H=0,I=new Array(B.length),J=new re,K=!1,L=d._meta.blobSupport?"blob":"base64";Vb(B,L,function(a){if(a)return f(a);g()})}function jc(a,b,c,d,e){function f(a){k=a.target.result,j&&e(j,k,l)}function g(a){j=a.target.result,k&&e(j,k,l)}function h(){if(!j.length)return e();var c,h=j[j.length-1];if(b&&b.upper)try{c=IDBKeyRange.bound(h,b.upper,!0,b.upperOpen)}catch(a){if("DataError"===a.name&&0===a.code)return e()}else c=IDBKeyRange.lowerBound(h,!0);b=c,j=null,k=null,a.getAll(b,d).onsuccess=f,a.getAllKeys(b,d).onsuccess=g}function i(a){var b=a.target.result;if(!b)return e();e([b.key],[b.value],b)}var j,k,l,m="function"==typeof a.getAll&&"function"==typeof a.getAllKeys&&d>1&&!c;m?(l={continue:h},a.getAll(b,d).onsuccess=f,a.getAllKeys(b,d).onsuccess=g):c?a.openCursor(b,"prev").onsuccess=i:a.openCursor(b).onsuccess=i}function kc(a,b,c){function d(a){var b=a.target.result;b?(e.push(b.value),b.continue()):c({target:{result:e}})}if("function"==typeof a.getAll)return void(a.getAll(b).onsuccess=c);var e=[];a.openCursor(b).onsuccess=d}function lc(a,b,c,d,e){try{if(a&&b)return e?IDBKeyRange.bound(b,a,!c,!1):IDBKeyRange.bound(a,b,!1,!c);if(a)return e?IDBKeyRange.upperBound(a):IDBKeyRange.lowerBound(a);if(b)return e?IDBKeyRange.lowerBound(b,!c):IDBKeyRange.upperBound(b,!c);if(d)return IDBKeyRange.only(d)}catch(a){return{error:a}}return null}function mc(a,b,c){function d(b,c,d){var e=b.id+"::"+d;z.get(e).onsuccess=function(d){if(c.doc=cc(d.target.result),a.conflicts){var e=Y(b);e.length&&(c.doc._conflicts=e)}ec(c.doc,a,u)}}function e(b,c){var e={id:c.id,key:c.id,value:{rev:b}},f=c.deleted;"ok"===a.deleted?(A.push(e),f?(e.value.deleted=!0,e.doc=null):a.include_docs&&d(c,e,b)):!f&&n--<=0&&(A.push(e),a.include_docs&&d(c,e,b))}function f(a){for(var b=0,c=a.length;b<c&&A.length!==o;b++){var d=a[b],f=bc(d);e(f.winningRev,f)}}function g(a,b,c){c&&(f(b),A.length<o&&c.continue())}function h(b){var c=b.target.result;a.descending&&(c=c.reverse()),f(c)}function i(){c(null,{total_rows:v,offset:a.skip,rows:A})}function j(){a.attachments?fc(A,a.binary).then(i):i()}var k="startkey"in a&&a.startkey,l="endkey"in a&&a.endkey,m="key"in a&&a.key,n=a.skip||0,o="number"==typeof a.limit?a.limit:-1,p=!1!==a.inclusive_end,q=lc(k,l,p,m,a.descending),r=q&&q.error;if(r&&("DataError"!==r.name||0!==r.code))return c(E(Ie,r.name,r.message));var s=[ef,ff,jf];a.attachments&&s.push(gf);var t=hc(b,s,"readonly");if(t.error)return c(t.error);var u=t.txn;u.oncomplete=j,u.onabort=_b(c);var v,w=u.objectStore(ef),x=u.objectStore(ff),y=u.objectStore(jf),z=x.index("_doc_id_rev"),A=[];return y.get(jf).onsuccess=function(a){v=a.target.result.docCount},
r||0===o?void 0:-1===o?kc(w,q,h):void jc(w,q,a.descending,o+n,g)}function nc(a){return new ne(function(b){var c=Cb([""]);a.objectStore(lf).put(c,"key").onsuccess=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),c=navigator.userAgent.match(/Edge\//);b(c||!a||parseInt(a[1],10)>=43)},a.onabort=function(a){a.preventDefault(),a.stopPropagation(),b(!1)}}).catch(function(){return!1})}function oc(a,b){a.objectStore(ef).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(a){b(a.target.result)}}function pc(a,b,c,d){try{a(b,c)}catch(b){d.emit("error",b)}}function qc(){!nf&&of.length&&(nf=!0,of.shift()())}function rc(a,b,c){of.push(function(){a(function(a,d){pc(b,a,d,c),nf=!1,je(function(){qc(c)})})}),qc()}function sc(a,b,c,d){function e(b,c,d){function e(b,c){var d=a.processChange(c,b,a);m=d.seq=b.seq;var e=v(d);if("object"==typeof e)return a.complete(e);e&&(u++,o&&t.push(d),a.attachments&&a.include_docs?ec(c,a,p,function(){fc([d],a.binary).then(function(){a.onChange(d)})}):a.onChange(d))}function f(){for(var a=0,b=h.length;a<b&&u!==n;a++){var c=h[a];if(c){e(i[a],c)}}u!==n&&d.continue()}if(d&&b.length){var h=new Array(b.length),i=new Array(b.length),j=0;c.forEach(function(a,c){g(cc(a),b[c],function(a,d){i[c]=a,h[c]=d,++j===b.length&&f()})})}}function f(a,b,c,d){if(c.seq!==b)return d();if(c.winningRev===a._rev)return d(c,a);var e=a._id+"::"+c.winningRev;s.get(e).onsuccess=function(a){d(c,cc(a.target.result))}}function g(a,b,c){if(l&&!l.has(a._id))return c();var d=w.get(a._id);if(d)return f(a,b,d,c);r.get(a._id).onsuccess=function(e){d=bc(e.target.result),w.set(a._id,d),f(a,b,d,c)}}function h(){a.complete(null,{results:t,last_seq:m})}function j(){!a.continuous&&a.attachments?fc(t).then(h):h()}if(a=i(a),a.continuous){var k=c+":"+Re();return mf.addListener(c,k,b,a),mf.notify(c),{cancel:function(){mf.removeListener(c,k)}}}var l=a.doc_ids&&new qe(a.doc_ids);a.since=a.since||0;var m=a.since,n="limit"in a?a.limit:-1;0===n&&(n=1);var o;o="return_docs"in a?a.return_docs:!("returnDocs"in a)||a.returnDocs;var p,q,r,s,t=[],u=0,v=H(a),w=new re,x=[ef,ff];a.attachments&&x.push(gf);var y=hc(d,x,"readonly");if(y.error)return a.complete(y.error);p=y.txn,p.onabort=_b(a.complete),p.oncomplete=j,q=p.objectStore(ff),r=p.objectStore(ef),s=q.index("_doc_id_rev"),jc(q,a.since&&!a.descending?IDBKeyRange.lowerBound(a.since,!0):null,a.descending,n,e)}function tc(a,b){var c=this;rc(function(b){uc(c,a,b)},b,c.constructor)}function uc(a,b,c){function d(a){var b=a.createObjectStore(ef,{keyPath:"id"});a.createObjectStore(ff,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),a.createObjectStore(gf,{keyPath:"digest"}),a.createObjectStore(jf,{keyPath:"id",autoIncrement:!1}),a.createObjectStore(lf),b.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),a.createObjectStore(kf,{keyPath:"_id"});var c=a.createObjectStore(hf,{autoIncrement:!0});c.createIndex("seq","seq"),c.createIndex("digestSeq","digestSeq",{unique:!0})}function e(a,b){var c=a.objectStore(ef);c.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),c.openCursor().onsuccess=function(a){var d=a.target.result;if(d){var e=d.value,f=ka(e);e.deletedOrLocal=f?"1":"0",c.put(e),d.continue()}else b()}}function f(a){a.createObjectStore(kf,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function g(a,b){var c=a.objectStore(kf),d=a.objectStore(ef),e=a.objectStore(ff);d.openCursor().onsuccess=function(a){var f=a.target.result;if(f){var g=f.value,h=g.id,i=la(h),j=U(g);if(i){var k=h+"::"+j,l=h+"::",m=h+"::~",n=e.index("_doc_id_rev"),o=IDBKeyRange.bound(l,m,!1,!1),p=n.openCursor(o);p.onsuccess=function(a){if(p=a.target.result){var b=p.value;b._doc_id_rev===k&&c.put(b),e.delete(p.primaryKey),p.continue()}else d.delete(f.primaryKey),f.continue()}}else f.continue()}else b&&b()}}function h(a){var b=a.createObjectStore(hf,{autoIncrement:!0});b.createIndex("seq","seq"),b.createIndex("digestSeq","digestSeq",{unique:!0})}function i(a,b){var c=a.objectStore(ff),d=a.objectStore(gf),e=a.objectStore(hf);d.count().onsuccess=function(a){if(!a.target.result)return b();c.openCursor().onsuccess=function(a){var c=a.target.result;if(!c)return b();for(var d=c.value,f=c.primaryKey,g=Object.keys(d._attachments||{}),h={},i=0;i<g.length;i++)h[d._attachments[g[i]].digest]=!0;var j=Object.keys(h);for(i=0;i<j.length;i++){var k=j[i];e.put({seq:f,digestSeq:k+"::"+f})}c.continue()}}}function j(a){function b(a){return a.data?bc(a):(a.deleted="1"===a.deletedOrLocal,a)}var c=a.objectStore(ff),d=a.objectStore(ef);d.openCursor().onsuccess=function(a){function e(){var a=ac(g,g.winningRev,g.deleted);d.put(a).onsuccess=function(){f.continue()}}var f=a.target.result;if(f){var g=b(f.value);if(g.winningRev=g.winningRev||U(g),g.seq)return e();!function(){var a=g.id+"::",b=g.id+"::￿",d=c.index("_doc_id_rev").openCursor(IDBKeyRange.bound(a,b)),f=0;d.onsuccess=function(a){var b=a.target.result;if(!b)return g.seq=f,e();var c=b.primaryKey;c>f&&(f=c),b.continue()}}()}}}var l=b.name,m=null;a._meta=null,a._remote=!1,a.type=function(){return"idb"},a._id=k(function(b){b(null,a._meta.instanceId)}),a._bulkDocs=function(c,d,e){ic(b,c,d,a,m,e)},a._get=function(a,b,c){function d(){c(g,{doc:e,metadata:f,ctx:h})}var e,f,g,h=b.ctx;if(!h){var i=hc(m,[ef,ff,gf],"readonly");if(i.error)return c(i.error);h=i.txn}h.objectStore(ef).get(a).onsuccess=function(a){if(!(f=bc(a.target.result)))return g=E(xe,"missing"),d();var c;if(b.rev)c=b.latest?ma(b.rev,f):b.rev;else{c=f.winningRev;if(ka(f))return g=E(xe,"deleted"),d()}var i=h.objectStore(ff),j=f.id+"::"+c;i.index("_doc_id_rev").get(j).onsuccess=function(a){if(e=a.target.result,e&&(e=cc(e)),!e)return g=E(xe,"missing"),d();d()}}},a._getAttachment=function(a,b,c,d,e){var f;if(d.ctx)f=d.ctx;else{var g=hc(m,[ef,ff,gf],"readonly");if(g.error)return e(g.error);f=g.txn}var h=c.digest,i=c.content_type;f.objectStore(gf).get(h).onsuccess=function(a){dc(a.target.result.body,i,d.binary,function(a){e(null,a)})}},a._info=function(b){var c,d,e=hc(m,[jf,ff],"readonly");if(e.error)return b(e.error);var f=e.txn;f.objectStore(jf).get(jf).onsuccess=function(a){d=a.target.result.docCount},f.objectStore(ff).openCursor(null,"prev").onsuccess=function(a){var b=a.target.result;c=b?b.key:0},f.oncomplete=function(){b(null,{doc_count:d,update_seq:c,idb_attachment_format:a._meta.blobSupport?"binary":"base64"})}},a._allDocs=function(a,b){mc(a,m,b)},a._changes=function(b){return sc(b,a,l,m)},a._close=function(a){m.close(),pf.delete(l),a()},a._getRevisionTree=function(a,b){var c=hc(m,[ef],"readonly");if(c.error)return b(c.error);c.txn.objectStore(ef).get(a).onsuccess=function(a){var c=bc(a.target.result);c?b(null,c.rev_tree):b(E(xe))}},a._doCompaction=function(a,b,c){var d=[ef,ff,gf,hf],e=hc(m,d,"readwrite");if(e.error)return c(e.error);var f=e.txn;f.objectStore(ef).get(a).onsuccess=function(c){var d=bc(c.target.result);V(d.rev_tree,function(a,c,d,e,f){var g=c+"-"+d;-1!==b.indexOf(g)&&(f.status="missing")}),gc(b,a,f);var e=d.winningRev,g=d.deleted;f.objectStore(ef).put(ac(d,e,g))},f.onabort=_b(c),f.oncomplete=function(){c()}},a._getLocal=function(a,b){var c=hc(m,[kf],"readonly");if(c.error)return b(c.error);var d=c.txn,e=d.objectStore(kf).get(a);e.onerror=_b(b),e.onsuccess=function(a){var c=a.target.result;c?(delete c._doc_id_rev,b(null,c)):b(E(xe))}},a._putLocal=function(a,b,c){"function"==typeof b&&(c=b,b={}),delete a._revisions;var d=a._rev,e=a._id;a._rev=d?"0-"+(parseInt(d.split("-")[1],10)+1):"0-1";var f,g=b.ctx;if(!g){var h=hc(m,[kf],"readwrite");if(h.error)return c(h.error);g=h.txn,g.onerror=_b(c),g.oncomplete=function(){f&&c(null,f)}}var i,j=g.objectStore(kf);d?(i=j.get(e),i.onsuccess=function(e){var g=e.target.result;if(g&&g._rev===d){j.put(a).onsuccess=function(){f={ok:!0,id:a._id,rev:a._rev},b.ctx&&c(null,f)}}else c(E(ye))}):(i=j.add(a),i.onerror=function(a){c(E(ye)),a.preventDefault(),a.stopPropagation()},i.onsuccess=function(){f={ok:!0,id:a._id,rev:a._rev},b.ctx&&c(null,f)})},a._removeLocal=function(a,b,c){"function"==typeof b&&(c=b,b={});var d=b.ctx;if(!d){var e=hc(m,[kf],"readwrite");if(e.error)return c(e.error);d=e.txn,d.oncomplete=function(){f&&c(null,f)}}var f,g=a._id,h=d.objectStore(kf),i=h.get(g);i.onerror=_b(c),i.onsuccess=function(d){var e=d.target.result;e&&e._rev===a._rev?(h.delete(g),f={ok:!0,id:g,rev:"0-0"},b.ctx&&c(null,f)):c(E(xe))}},a._destroy=function(a,b){mf.removeAllListeners(l);var c=qf.get(l);c&&c.result&&(c.result.close(),pf.delete(l));var d=indexedDB.deleteDatabase(l);d.onsuccess=function(){qf.delete(l),w()&&l in localStorage&&delete localStorage[l],b(null,{ok:!0})},d.onerror=_b(b)};var n=pf.get(l);if(n)return m=n.idb,a._meta=n.global,je(function(){c(null,a)});var o;o=b.storage?vc(l,b.storage):indexedDB.open(l,df),qf.set(l,o),o.onupgradeneeded=function(a){function b(){var a=l[m-1];m++,a&&a(k,b)}var c=a.target.result;if(a.oldVersion<1)return d(c);var k=a.currentTarget.transaction;a.oldVersion<3&&f(c),a.oldVersion<4&&h(c);var l=[e,g,i,j],m=a.oldVersion;b()},o.onsuccess=function(b){function d(){void 0!==h&&k&&(a._meta={name:l,instanceId:i,blobSupport:h},pf.set(l,{idb:m,global:a._meta}),c(null,a))}function e(){if(void 0!==g&&void 0!==f){var a=l+"_id";a in f?i=f[a]:f[a]=i=Re(),f.docCount=g,j.objectStore(jf).put(f)}}m=b.target.result,m.onversionchange=function(){m.close(),pf.delete(l)},m.onabort=function(a){z("error","Database has a global failure",a.target.error),m.close(),pf.delete(l)};var f,g,h,i,j=m.transaction([jf,lf,ef],"readwrite"),k=!1;j.objectStore(jf).get(jf).onsuccess=function(a){f=a.target.result||{id:jf},e()},oc(j,function(a){g=a,e()}),Ye||(Ye=nc(j)),Ye.then(function(a){h=a,d()}),j.oncomplete=function(){k=!0,d()}},o.onerror=function(){var a="Failed to open indexedDB, are you in private browsing mode?";z("error",a),c(E(Ie,a))}}function vc(a,b){try{return indexedDB.open(a,{version:df,storage:b})}catch(b){return indexedDB.open(a,df)}}function wc(a){return decodeURIComponent(escape(a))}function xc(a){return a<65?a-48:a-55}function yc(a,b,c){for(var d="";b<c;)d+=String.fromCharCode(xc(a.charCodeAt(b++))<<4|xc(a.charCodeAt(b++)));return d}function zc(a,b,c){for(var d="";b<c;)d+=String.fromCharCode(xc(a.charCodeAt(b+2))<<12|xc(a.charCodeAt(b+3))<<8|xc(a.charCodeAt(b))<<4|xc(a.charCodeAt(b+1))),b+=4;return d}function Ac(a,b){return"UTF-8"===b?wc(yc(a,0,a.length)):zc(a,0,a.length)}function Bc(a){return"'"+a+"'"}function Cc(a){return a.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function Dc(a){return a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function Ec(a){return delete a._id,delete a._rev,JSON.stringify(a)}function Fc(a,b,c){return a=JSON.parse(a),a._id=b,a._rev=c,a}function Gc(a){for(var b="(";a--;)b+="?",a&&(b+=",");return b+")"}function Hc(a,b,c,d,e){return"SELECT "+a+" FROM "+("string"==typeof b?b:b.join(" JOIN "))+(c?" ON "+c:"")+(d?" WHERE "+("string"==typeof d?d:d.join(" AND ")):"")+(e?" ORDER BY "+e:"")}function Ic(a,b,c){function d(){++f===a.length&&e()}function e(){if(g.length){var a="SELECT DISTINCT digest AS digest FROM "+yf+" WHERE seq IN "+Gc(g.length);c.executeSql(a,g,function(a,b){for(var c=[],d=0;d<b.rows.length;d++)c.push(b.rows.item(d).digest);if(c.length){var e="DELETE FROM "+yf+" WHERE seq IN ("+g.map(function(){return"?"}).join(",")+")";a.executeSql(e,g,function(a){var b="SELECT digest FROM "+yf+" WHERE digest IN ("+c.map(function(){return"?"}).join(",")+")";a.executeSql(b,c,function(a,b){for(var d=new qe,e=0;e<b.rows.length;e++)d.add(b.rows.item(e).digest);c.forEach(function(b){d.has(b)||(a.executeSql("DELETE FROM "+yf+" WHERE digest=?",[b]),a.executeSql("DELETE FROM "+vf+" WHERE digest=?",[b]))})})})}})}}if(a.length){var f=0,g=[];a.forEach(function(a){var e="SELECT seq FROM "+uf+" WHERE doc_id=? AND rev=?";c.executeSql(e,[b,a],function(a,b){if(!b.rows.length)return d();var c=b.rows.item(0).seq;g.push(c),a.executeSql("DELETE FROM "+uf+" WHERE seq=?",[c],d)})})}}function Jc(a){return function(b){z("error","WebSQL threw an error",b);var c=b&&b.constructor.toString().match(/function ([^(]+)/),d=c&&c[1]||b.type,e=b.target||b.message;a(E(Je,e,d))}}function Kc(a){return"size"in a?1e6*a.size:"undefined"!=typeof navigator&&/Android/.test(navigator.userAgent)?5e6:1}function Lc(a,b,c,d,e,f,g){function h(){if(t)return g(t);f.notify(d._name),g(null,u)}function i(a,b){var c="SELECT count(*) as cnt FROM "+vf+" WHERE digest=?";s.executeSql(c,[a],function(c,d){if(0===d.rows.item(0).cnt){var e=E(Le,"unknown stub attachment with digest "+a);b(e)}else b()})}function j(a){function b(){++e===c.length&&a(d)}var c=[];if(q.forEach(function(a){a.data&&a.data._attachments&&Object.keys(a.data._attachments).forEach(function(b){var d=a.data._attachments[b];d.stub&&c.push(d.digest)})}),!c.length)return a();var d,e=0;c.forEach(function(a){i(a,function(a){a&&!d&&(d=a),b()})})}function k(a,b,c,e,f,g,h,i){function j(){function b(a,b){function d(){return++e===f.length&&b(),!1}var e=0,f=Object.keys(c._attachments||{});if(!f.length)return b();for(var g=0;g<f.length;g++)!function(b){var e="INSERT INTO "+yf+" (digest, seq) VALUES (?,?)",f=[c._attachments[b].digest,a];s.executeSql(e,f,d,d)}(f[g])}var c=a.data,d=e?1:0,f=c._id,g=c._rev,h=Ec(c),i="INSERT INTO "+uf+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",j=[f,g,h,d];s.executeSql(i,j,function(a,c){var d=c.insertId;b(d,function(){m(a,d)})},function(){var a=Hc("seq",uf,null,"doc_id=? AND rev=?");return s.executeSql(a,[f,g],function(a,c){var e=c.rows.item(0).seq,i="UPDATE "+uf+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",j=[h,d,f,g];a.executeSql(i,j,function(a){b(e,function(){m(a,e)})})}),!1})}function k(a){o||(a?(o=a,i(o)):p===q.length&&j())}function l(a){p++,k(a)}function m(c,e){var g=a.metadata.id,j=a.stemmedRevs||[];f&&d.auto_compaction&&(j=Z(a.metadata).concat(j)),j.length&&Ic(j,g,c),a.metadata.seq=e;var k=a.metadata.rev;delete a.metadata.rev;var l=f?"UPDATE "+tf+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+uf+" WHERE doc_id="+tf+".id AND rev=?) WHERE id=?":"INSERT INTO "+tf+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",m=$b(a.metadata),n=f?[m,e,b,g]:[g,e,e,m];c.executeSql(l,n,function(){u[h]={ok:!0,id:a.metadata.id,rev:k},v.set(g,a.metadata),i()})}var o=null,p=0;a.data._id=a.metadata.id,a.data._rev=a.metadata.rev;var q=Object.keys(a.data._attachments||{});e&&(a.data._deleted=!0),q.forEach(function(c){var d=a.data._attachments[c];if(d.stub)p++,k();else{var e=d.data;delete d.data,d.revpos=parseInt(b,10);n(d.digest,e,l)}}),q.length||j()}function l(){Yb(a.revs_limit,q,d,v,s,u,k,c)}function m(a){function b(){++c===q.length&&a()}if(!q.length)return a();var c=0;q.forEach(function(a){if(a._id&&la(a._id))return b();var c=a.metadata.id;s.executeSql("SELECT json FROM "+tf+" WHERE id = ?",[c],function(a,d){if(d.rows.length){var e=Zb(d.rows.item(0).json);v.set(c,e)}b()})})}function n(a,b,c){var d="SELECT digest FROM "+vf+" WHERE digest=?";s.executeSql(d,[a],function(e,f){if(f.rows.length)return c();d="INSERT INTO "+vf+" (digest, body, escaped) VALUES (?,?,1)",e.executeSql(d,[a,Cc(b)],function(){c()},function(){return c(),!1})})}var o=c.new_edits,p=b.docs,q=p.map(function(a){return a._id&&la(a._id)?a:Bb(a,o)}),r=q.filter(function(a){return a.error});if(r.length)return g(r[0]);var s,t,u=new Array(q.length),v=new re;Vb(q,"binary",function(a){if(a)return g(a);e.transaction(function(a){s=a,j(function(a){a?t=a:m(l)})},Jc(g),h)})}function Mc(a){return a.websql(a.name,a.version,a.description,a.size)}function Nc(a){try{return{db:Mc(a)}}catch(a){return{error:a}}}function Oc(a){var b=zf.get(a.name);return b||(b=Nc(a),zf.set(a.name,b)),b}function Pc(a,b,c,d,e){function f(){++i===h.length&&e&&e()}function g(a,e){var g=a._attachments[e],h={binary:b.binary,ctx:d};c._getAttachment(a._id,e,g,h,function(b,c){a._attachments[e]=ve(r(g,["digest","content_type"]),{data:c}),f()})}var h=Object.keys(a._attachments||{});if(!h.length)return e&&e();var i=0;h.forEach(function(c){b.attachments&&b.include_docs?g(a,c):(a._attachments[c].stub=!0,f())})}function Qc(a,b){function c(){w()&&(window.localStorage["_pouch__websqldb_"+t._name]=!0),b(null,t)}function d(a,b){a.executeSql(Ef),a.executeSql("ALTER TABLE "+uf+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){a.executeSql(Cf),a.executeSql("ALTER TABLE "+tf+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){a.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+tf+" (local, id)");var c="SELECT "+tf+".winningseq AS seq, "+tf+".json AS metadata FROM "+uf+" JOIN "+tf+" ON "+uf+".seq = "+tf+".winningseq";a.executeSql(c,[],function(a,c){for(var d=[],e=[],f=0;f<c.rows.length;f++){var g=c.rows.item(f),h=g.seq,i=JSON.parse(g.metadata);ka(i)&&d.push(h),la(i.id)&&e.push(i.id)}a.executeSql("UPDATE "+tf+"SET local = 1 WHERE id IN "+Gc(e.length),e,function(){a.executeSql("UPDATE "+uf+" SET deleted = 1 WHERE seq IN "+Gc(d.length),d,b)})})})})}function e(a,b){var c="CREATE TABLE IF NOT EXISTS "+wf+" (id UNIQUE, rev, json)";a.executeSql(c,[],function(){var c="SELECT "+tf+".id AS id, "+uf+".json AS data FROM "+uf+" JOIN "+tf+" ON "+uf+".seq = "+tf+".winningseq WHERE local = 1";a.executeSql(c,[],function(a,c){function d(){if(!e.length)return b(a);var c=e.shift(),f=JSON.parse(c.data)._rev;a.executeSql("INSERT INTO "+wf+" (id, rev, json) VALUES (?,?,?)",[c.id,f,c.data],function(a){a.executeSql("DELETE FROM "+tf+" WHERE id=?",[c.id],function(a){a.executeSql("DELETE FROM "+uf+" WHERE seq=?",[c.seq],function(){d()})})})}for(var e=[],f=0;f<c.rows.length;f++)e.push(c.rows.item(f));d()})})}function f(a,b){function c(c){function d(){if(!c.length)return b(a);var e=c.shift(),f=Ac(e.hex,s),g=f.lastIndexOf("::"),h=f.substring(0,g),i=f.substring(g+2),j="UPDATE "+uf+" SET doc_id=?, rev=? WHERE doc_id_rev=?";a.executeSql(j,[h,i,f],function(){d()})}d()}var d="ALTER TABLE "+uf+" ADD COLUMN doc_id";a.executeSql(d,[],function(a){var b="ALTER TABLE "+uf+" ADD COLUMN rev";a.executeSql(b,[],function(a){a.executeSql(Df,[],function(a){var b="SELECT hex(doc_id_rev) as hex FROM "+uf;a.executeSql(b,[],function(a,b){for(var d=[],e=0;e<b.rows.length;e++)d.push(b.rows.item(e));c(d)})})})})}function g(a,b){function c(a){var c="SELECT COUNT(*) AS cnt FROM "+vf;a.executeSql(c,[],function(a,c){function d(){var c=Hc(If+", "+tf+".id AS id",[tf,uf],Hf,null,tf+".id ");c+=" LIMIT "+f+" OFFSET "+e,e+=f,a.executeSql(c,[],function(a,c){if(!c.rows.length)return b(a);for(var e={},f=0;f<c.rows.length;f++)for(var g=c.rows.item(f),h=Fc(g.data,g.id,g.rev),i=Object.keys(h._attachments||{}),j=0;j<i.length;j++){var k=h._attachments[i[j]];!function(a,b){var c=e[a]=e[a]||[];-1===c.indexOf(b)&&c.push(b)}(k.digest,g.seq)}var l=[];if(Object.keys(e).forEach(function(a){e[a].forEach(function(b){l.push([a,b])})}),!l.length)return d();var m=0;l.forEach(function(b){var c="INSERT INTO "+yf+" (digest, seq) VALUES (?,?)";a.executeSql(c,b,function(){++m===l.length&&d()})})})}if(!c.rows.item(0).cnt)return b(a);var e=0,f=10;d()})}var d="CREATE TABLE IF NOT EXISTS "+yf+" (digest, seq INTEGER)";a.executeSql(d,[],function(a){a.executeSql(Gf,[],function(a){a.executeSql(Ff,[],c)})})}function h(a,b){var c="ALTER TABLE "+vf+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";a.executeSql(c,[],b)}function j(a,b){var c="ALTER TABLE "+tf+" ADD COLUMN max_seq INTEGER";a.executeSql(c,[],function(a){var c="UPDATE "+tf+" SET max_seq=(SELECT MAX(seq) FROM "+uf+" WHERE doc_id=id)";a.executeSql(c,[],function(a){var c="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+tf+" (max_seq)";a.executeSql(c,[],b)})})}function l(a,b){a.executeSql('SELECT HEX("a") AS hex',[],function(a,c){var d=c.rows.item(0).hex;s=2===d.length?"UTF-8":"UTF-16",b()})}function m(){for(;x.length>0;){x.pop()(null,u)}}function n(a,b){if(0===b){var c="CREATE TABLE IF NOT EXISTS "+xf+" (dbid, db_version INTEGER)",i="CREATE TABLE IF NOT EXISTS "+vf+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",k="CREATE TABLE IF NOT EXISTS "+yf+" (digest, seq INTEGER)",l="CREATE TABLE IF NOT EXISTS "+tf+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",n="CREATE TABLE IF NOT EXISTS "+uf+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",o="CREATE TABLE IF NOT EXISTS "+wf+" (id UNIQUE, rev, json)";a.executeSql(i),a.executeSql(o),a.executeSql(k,[],function(){a.executeSql(Ff),a.executeSql(Gf)}),a.executeSql(l,[],function(){a.executeSql(Ef),a.executeSql(n,[],function(){a.executeSql(Cf),a.executeSql(Df),a.executeSql(c,[],function(){var b="INSERT INTO "+xf+" (db_version, dbid) VALUES (?,?)";u=Re();var c=[sf,u];a.executeSql(b,c,function(){m()})})})})}else{var p=function(){b<sf&&a.executeSql("UPDATE "+xf+" SET db_version = "+sf);var c="SELECT dbid FROM "+xf;a.executeSql(c,[],function(a,b){u=b.rows.item(0).dbid,m()})},q=[d,e,f,g,h,j,p],r=b,s=function(a){q[r-1](a,s),r++};s(a)}}function o(a){var b="SELECT sql FROM sqlite_master WHERE tbl_name = "+xf;a.executeSql(b,[],function(a,b){b.rows.length?/db_version/.test(b.rows.item(0).sql)?a.executeSql("SELECT db_version FROM "+xf,[],function(a,b){n(a,b.rows.item(0).db_version)}):a.executeSql("ALTER TABLE "+xf+" ADD COLUMN db_version INTEGER",[],function(){n(a,1)}):n(a,0)})}function p(a,b){var c="SELECT MAX(seq) AS seq FROM "+uf;a.executeSql(c,[],function(a,c){var d=c.rows.item(0).seq||0;b(d)})}function q(a,b){var c=Hc("COUNT("+tf+".id) AS 'num'",[tf,uf],Hf,uf+".deleted=0");a.executeSql(c,[],function(a,c){b(c.rows.item(0).num)})}function r(a,b,c,d,e){var f=Hc(If,[tf,uf],Hf,tf+".id=?"),g=[b];a.executeSql(f,g,function(a,b){if(!b.rows.length){var f=E(xe,"missing");return e(f)}var g=b.rows.item(0),h=Zb(g.metadata);d(ma(c,h))})}var s,t=this,u=null,v=Kc(a),x=[];t._name=a.name;var y=ve({},a,{version:Bf,description:a.name,size:v}),z=Oc(y);if(z.error)return Jc(b)(z.error);var A=z.db;"function"!=typeof A.readTransaction&&(A.readTransaction=A.transaction),function(){A.transaction(function(a){l(a,function(){o(a)})},Jc(b),c)}(),t._remote=!1,t.type=function(){return"websql"},t._id=k(function(a){a(null,u)}),t._info=function(a){var b,c;A.readTransaction(function(a){p(a,function(a){b=a}),q(a,function(a){c=a})},Jc(a),function(){a(null,{doc_count:c,update_seq:b,websql_encoding:s})})},t._bulkDocs=function(b,c,d){Lc(a,b,c,t,A,Af,d)},t._get=function(a,b,c){function d(a){c(a,{doc:e,metadata:f,ctx:g})}var e,f,g=b.ctx;if(!g)return A.readTransaction(function(d){t._get(a,ve({ctx:d},b),c)});var h,i;if(b.rev){if(b.latest)return void r(g,a,b.rev,function(d){b.latest=!1,b.rev=d,t._get(a,b,c)},d);h=Hc(If,[tf,uf],tf+".id="+uf+".doc_id",[uf+".doc_id=?",uf+".rev=?"]),i=[a,b.rev]}else h=Hc(If,[tf,uf],Hf,tf+".id=?"),i=[a];g.executeSql(h,i,function(a,c){if(!c.rows.length){return d(E(xe,"missing"))}var g=c.rows.item(0);if(f=Zb(g.metadata),g.deleted&&!b.rev){return d(E(xe,"deleted"))}e=Fc(g.data,f.id,g.rev),d()})},t._allDocs=function(a,b){var c,d=[],e="startkey"in a&&a.startkey,f="endkey"in a&&a.endkey,g="key"in a&&a.key,h="descending"in a&&a.descending,i="limit"in a?a.limit:-1,j="skip"in a?a.skip:0,k=!1!==a.inclusive_end,l=[],m=[];if(!1!==g)m.push(tf+".id = ?"),l.push(g);else if(!1!==e||!1!==f){if(!1!==e&&(m.push(tf+".id "+(h?"<=":">=")+" ?"),l.push(e)),!1!==f){var n=h?">":"<";k&&(n+="="),m.push(tf+".id "+n+" ?"),l.push(f)}!1!==g&&(m.push(tf+".id = ?"),l.push(g))}"ok"!==a.deleted&&m.push(uf+".deleted = 0"),A.readTransaction(function(b){if(q(b,function(a){c=a}),0!==i){var e=Hc(If,[tf,uf],Hf,m,tf+".id "+(h?"DESC":"ASC"));e+=" LIMIT "+i+" OFFSET "+j,b.executeSql(e,l,function(b,c){for(var e=0,f=c.rows.length;e<f;e++){var g=c.rows.item(e),h=Zb(g.metadata),i=h.id,j=Fc(g.data,i,g.rev),k=j._rev,l={id:i,key:i,value:{rev:k}};if(a.include_docs){if(l.doc=j,l.doc._rev=k,a.conflicts){var m=Y(h);m.length&&(l.doc._conflicts=m)}Pc(l.doc,a,t,b)}if(g.deleted){if("ok"!==a.deleted)continue;l.value.deleted=!0,l.doc=null}d.push(l)}})}},Jc(b),function(){b(null,{total_rows:c,offset:a.skip,rows:d})})},t._changes=function(a){if(a=i(a),a.continuous){var b=t._name+":"+Re();return Af.addListener(t._name,b,t,a),Af.notify(t._name),{cancel:function(){Af.removeListener(t._name,b)}}}var c=a.descending;a.since=a.since&&!c?a.since:0;var d="limit"in a?a.limit:-1;0===d&&(d=1);var e;e="return_docs"in a?a.return_docs:!("returnDocs"in a)||a.returnDocs;var f=[],g=0;!function(){var b=tf+".json AS metadata, "+tf+".max_seq AS maxSeq, "+uf+".json AS winningDoc, "+uf+".rev AS winningRev ",h=tf+" JOIN "+uf,i=tf+".id="+uf+".doc_id AND "+tf+".winningseq="+uf+".seq",j=["maxSeq > ?"],k=[a.since];a.doc_ids&&(j.push(tf+".id IN "+Gc(a.doc_ids.length)),k=k.concat(a.doc_ids));var l="maxSeq "+(c?"DESC":"ASC"),m=Hc(b,h,i,j,l),n=H(a);a.view||a.filter||(m+=" LIMIT "+d);var o=a.since||0;A.readTransaction(function(b){b.executeSql(m,k,function(b,c){function h(b){return function(){a.onChange(b)}}for(var i=0,j=c.rows.length;i<j;i++){var k=c.rows.item(i),l=Zb(k.metadata);o=k.maxSeq;var m=Fc(k.winningDoc,l.id,k.winningRev),p=a.processChange(m,l,a);p.seq=k.maxSeq;var q=n(p);if("object"==typeof q)return a.complete(q);if(q&&(g++,e&&f.push(p),a.attachments&&a.include_docs?Pc(m,a,t,b,h(p)):h(p)()),g===d)break}})},Jc(a.complete),function(){a.continuous||a.complete(null,{results:f,last_seq:o})})}()},t._close=function(a){a()},t._getAttachment=function(a,b,c,d,e){var f,g=d.ctx,h=c.digest,i=c.content_type,j="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+vf+" WHERE digest=?";g.executeSql(j,[h],function(a,b){var c=b.rows.item(0),g=c.escaped?Dc(c.body):Ac(c.body,s);f=d.binary?Eb(g,i):af(g),e(null,f)})},t._getRevisionTree=function(a,b){A.readTransaction(function(c){var d="SELECT json AS metadata FROM "+tf+" WHERE id = ?";c.executeSql(d,[a],function(a,c){if(c.rows.length){var d=Zb(c.rows.item(0).metadata);b(null,d.rev_tree)}else b(E(xe))})})},t._doCompaction=function(a,b,c){if(!b.length)return c();A.transaction(function(c){var d="SELECT json AS metadata FROM "+tf+" WHERE id = ?";c.executeSql(d,[a],function(c,d){var e=Zb(d.rows.item(0).metadata);V(e.rev_tree,function(a,c,d,e,f){var g=c+"-"+d;-1!==b.indexOf(g)&&(f.status="missing")});var f="UPDATE "+tf+" SET json = ? WHERE id = ?";c.executeSql(f,[$b(e),a])}),Ic(b,a,c)},Jc(c),function(){c()})},t._getLocal=function(a,b){A.readTransaction(function(c){var d="SELECT json, rev FROM "+wf+" WHERE id=?";c.executeSql(d,[a],function(c,d){if(d.rows.length){var e=d.rows.item(0),f=Fc(e.json,a,e.rev);b(null,f)}else b(E(xe))})})},t._putLocal=function(a,b,c){function d(a){var d,j;f?(d="UPDATE "+wf+" SET rev=?, json=? WHERE id=? AND rev=?",j=[e,i,g,f]):(d="INSERT INTO "+wf+" (id, rev, json) VALUES (?,?,?)",j=[g,e,i]),a.executeSql(d,j,function(a,d){d.rowsAffected?(h={ok:!0,id:g,rev:e},b.ctx&&c(null,h)):c(E(ye))},function(){return c(E(ye)),!1})}"function"==typeof b&&(c=b,b={}),delete a._revisions;var e,f=a._rev,g=a._id;e=a._rev=f?"0-"+(parseInt(f.split("-")[1],10)+1):"0-1";var h,i=Ec(a);b.ctx?d(b.ctx):A.transaction(d,Jc(c),function(){h&&c(null,h)})},t._removeLocal=function(a,b,c){function d(d){var f="DELETE FROM "+wf+" WHERE id=? AND rev=?",g=[a._id,a._rev];d.executeSql(f,g,function(d,f){if(!f.rowsAffected)return c(E(xe));e={ok:!0,id:a._id,rev:"0-0"},b.ctx&&c(null,e)})}"function"==typeof b&&(c=b,b={});var e;b.ctx?d(b.ctx):A.transaction(d,Jc(c),function(){e&&c(null,e)})},t._destroy=function(a,b){Af.removeAllListeners(t._name),A.transaction(function(a){[tf,uf,vf,xf,wf,yf].forEach(function(b){a.executeSql("DROP TABLE IF EXISTS "+b,[])})},Jc(b),function(){w()&&(delete window.localStorage["_pouch__websqldb_"+t._name],delete window.localStorage[t._name]),b(null,{ok:!0})})}}function Rc(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(a){return!1}}function Sc(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var a=w(),b="_pouch__websqldb_valid_"+navigator.userAgent;if(a&&localStorage[b])return"1"===localStorage[b];var c=Rc();return a&&(localStorage[b]=c?"1":"0"),c}function Tc(){return"function"==typeof openDatabase&&Sc()}function Uc(a,b,c,d){return openDatabase(a,b,c,d)}function Vc(a,b){var c=ve({websql:Uc},a);Qc.call(this,c,b)}function Wc(){for(var a={},b=new ne(function(b,c){a.resolve=b,a.reject=c}),c=new Array(arguments.length),d=0;d<c.length;d++)c[d]=arguments[d];return a.promise=b,ne.resolve().then(function(){return fetch.apply(null,c)}).then(function(b){a.resolve(b)}).catch(function(b){a.reject(b)}),a}function Xc(a,b){var c,d,e,f=new Headers,g={method:a.method,credentials:"include",headers:f};return a.json&&(f.set("Accept","application/json"),f.set("Content-Type",a.headers["Content-Type"]||"application/json")),a.body&&a.processData&&"string"!=typeof a.body?g.body=JSON.stringify(a.body):g.body="body"in a?a.body:null,Object.keys(a.headers).forEach(function(b){a.headers.hasOwnProperty(b)&&f.set(b,a.headers[b])}),c=Wc(a.url,g),a.timeout>0&&(d=setTimeout(function(){c.reject(new Error("Load timeout for resource: "+a.url))},a.timeout)),c.promise.then(function(b){return e={statusCode:b.status},a.timeout>0&&clearTimeout(d),e.statusCode>=200&&e.statusCode<300?a.binary?b.blob():b.text():b.json()}).then(function(a){e.statusCode>=200&&e.statusCode<300?b(null,e,a):(a.status=e.statusCode,b(a))}).catch(function(a){a||(a=new Error("canceled")),b(a)}),{abort:c.reject}}function Yc(a,b){var c,d,e=!1,f=function(){c.abort(),i()},g=function(){e=!0,c.abort(),i()},h={abort:f},i=function(){clearTimeout(d),h.abort=function(){},c&&(c.onprogress=void 0,c.upload&&(c.upload.onprogress=void 0),c.onreadystatechange=void 0,c=void 0)};c=a.xhr?new a.xhr:new XMLHttpRequest;try{c.open(a.method,a.url)}catch(a){return b(new Error(a.name||"Url is invalid"))}c.withCredentials=!("withCredentials"in a)||a.withCredentials,"GET"===a.method?delete a.headers["Content-Type"]:a.json&&(a.headers.Accept="application/json",a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json",a.body&&a.processData&&"string"!=typeof a.body&&(a.body=JSON.stringify(a.body))),a.binary&&(c.responseType="arraybuffer"),"body"in a||(a.body=null);for(var j in a.headers)a.headers.hasOwnProperty(j)&&c.setRequestHeader(j,a.headers[j]);return a.timeout>0&&(d=setTimeout(g,a.timeout),c.onprogress=function(){clearTimeout(d),4!==c.readyState&&(d=setTimeout(g,a.timeout))},void 0!==c.upload&&(c.upload.onprogress=c.onprogress)),c.onreadystatechange=function(){if(4===c.readyState){var d={statusCode:c.status};if(c.status>=200&&c.status<300){var f;f=a.binary?Cb([c.response||""],{type:c.getResponseHeader("Content-Type")}):c.responseText,b(null,d,f)}else{var g={};if(e)g=new Error("ETIMEDOUT"),g.code="ETIMEDOUT";else if("string"==typeof c.response)try{g=JSON.parse(c.response)}catch(a){}g.status=c.status,b(g)}i()}},a.body&&a.body instanceof Blob?Kb(a.body,function(a){c.send(a)}):c.send(a.body),h}function Zc(a,b){return Kf||a.xhr?Yc(a,b):Xc(a,b)}function $c(){return""}function _c(a,b){function c(b,c,d){if(!a.binary&&a.json&&"string"==typeof b)try{b=JSON.parse(b)}catch(a){return d(a)}Array.isArray(b)&&(b=b.map(function(a){return a.error||a.missing?F(a):a})),a.binary&&Lf(b,c),d(null,b,c)}return a=i(a),a=ve({method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1},a),a.json&&(a.binary||(a.headers.Accept="application/json"),a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"),a.binary&&(a.encoding=null,a.json=!1),a.processData||(a.json=!1),Zc(a,function(d,e,f){if(d)return b(F(d));var g,h=e.headers&&e.headers["content-type"],i=f||$c();if(!a.binary&&(a.json||!a.processData)&&"object"!=typeof i&&(/json/.test(h)||/^[\s]*\{/.test(i)&&/\}[\s]*$/.test(i)))try{i=JSON.parse(i.toString())}catch(a){}e.statusCode>=200&&e.statusCode<300?c(i,e,b):(g=F(i),g.status=e.statusCode,b(g))})}function ad(a,b){var c=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",d=-1!==c.indexOf("safari")&&-1===c.indexOf("chrome"),e=-1!==c.indexOf("msie"),f=-1!==c.indexOf("edge"),g=d||(e||f)&&"GET"===a.method,h=!("cache"in a)||a.cache;if(!/^blob:/.test(a.url)&&(g||!h)){var i=-1!==a.url.indexOf("?");a.url+=(i?"&":"?")+"_nonce="+Date.now()}return _c(a,b)}function bd(a,b){
return new ne(function(c,d){function e(){k++,a[l++]().then(g,h)}function f(){++m===n?j?d(j):c():i()}function g(){k--,f()}function h(a){k--,j=j||a,f()}function i(){for(;k<b&&l<n;)e()}var j,k=0,l=0,m=0,n=a.length;i()})}function cd(a){var b=a.doc&&a.doc._attachments;b&&Object.keys(b).forEach(function(a){var c=b[a];c.data=Fb(c.data,c.content_type)})}function dd(a){return/^_design/.test(a)?"_design/"+encodeURIComponent(a.slice(8)):/^_local/.test(a)?"_local/"+encodeURIComponent(a.slice(7)):encodeURIComponent(a)}function ed(a){return a._attachments&&Object.keys(a._attachments)?ne.all(Object.keys(a._attachments).map(function(b){var c=a._attachments[b];if(c.data&&"string"!=typeof c.data)return new ne(function(a){Jb(c.data,a)}).then(function(a){c.data=a})})):ne.resolve()}function fd(a){if(!a.prefix)return!1;var b=P(a.prefix).protocol;return"http"===b||"https"===b}function gd(a,b){if(fd(b)){var c=b.name.substr(b.prefix.length);a=b.prefix+encodeURIComponent(c)}var d=P(a);(d.user||d.password)&&(d.auth={username:d.user,password:d.password});var e=d.path.replace(/(^\/|\/$)/g,"").split("/");return d.db=e.pop(),-1===d.db.indexOf("%")&&(d.db=encodeURIComponent(d.db)),d.path=e.join("/"),d}function hd(a,b){return id(a,a.db+"/"+b)}function id(a,b){var c=a.path?"/":"";return a.protocol+"://"+a.host+(a.port?":"+a.port:"")+"/"+a.path+c+b}function jd(a){return"?"+Object.keys(a).map(function(b){return b+"="+encodeURIComponent(a[b])}).join("&")}function kd(a,b){function c(a,b,c){var d=a.ajax||{},e=ve(i(l),d,b),f=i(l.headers||{});return e.headers=ve(f,d.headers,b.headers||{}),h.constructor.listeners("debug").length&&h.constructor.emit("debug",["http",e.method,e.url]),h._ajax(e,c)}function d(a,b){return new ne(function(d,e){c(a,b,function(a,b){if(a)return e(a);d(b)})})}function e(a,b){return m(a,ge(function(a){f().then(function(){return b.apply(this,a)}).catch(function(b){a.pop()(b)})}))}function f(){return a.skipSetup||a.skip_setup?ne.resolve():q||(q=d({},{method:"GET",url:k}).catch(function(a){return a&&a.status&&404===a.status?(C(404,"PouchDB is just detecting if the remote exists."),d({},{method:"PUT",url:k})):ne.reject(a)}).catch(function(a){return!(!a||!a.status||412!==a.status)||ne.reject(a)}),q.catch(function(){q=null}),q)}function g(a){return a.split("/").map(encodeURIComponent).join("/")}var h=this,j=gd(a.name,a),k=hd(j,"");a=i(a);var l=a.ajax||{};if(a.auth||j.auth){var n=a.auth||j.auth,o=n.username+":"+n.password,p=af(unescape(encodeURIComponent(o)));l.headers=l.headers||{},l.headers.Authorization="Basic "+p}h._ajax=ad;var q;je(function(){b(null,h)}),h._remote=!0,h.type=function(){return"http"},h.id=e("id",function(a){c({},{method:"GET",url:id(j,"")},function(b,c){var d=c&&c.uuid?c.uuid+j.db:hd(j,"");a(null,d)})}),h.request=e("request",function(a,b){a.url=hd(j,a.url),c({},a,b)}),h.compact=e("compact",function(a,b){"function"==typeof a&&(b=a,a={}),a=i(a),c(a,{url:hd(j,"_compact"),method:"POST"},function(){function c(){h.info(function(d,e){e&&!e.compact_running?b(null,{ok:!0}):setTimeout(c,a.interval||200)})}c()})}),h.bulkGet=m("bulkGet",function(a,b){function d(b){var d={};a.revs&&(d.revs=!0),a.attachments&&(d.attachments=!0),a.latest&&(d.latest=!0),c(a,{url:hd(j,"_bulk_get"+jd(d)),method:"POST",body:{docs:a.docs}},b)}function e(){for(var c=Nf,d=Math.ceil(a.docs.length/c),e=0,g=new Array(d),h=0;h<d;h++){var i=r(a,["revs","attachments","latest"]);i.ajax=l,i.docs=a.docs.slice(h*c,Math.min(a.docs.length,(h+1)*c)),u(f,i,function(a){return function(c,f){g[a]=f.results,++e===d&&b(null,{results:I(g)})}}(h))}}var f=this,g=id(j,""),h=Qf[g];"boolean"!=typeof h?d(function(a,c){a?(Qf[g]=!1,C(a.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),e()):(Qf[g]=!0,b(null,c))}):h?d(b):e()}),h._info=function(a){f().then(function(){c({},{method:"GET",url:hd(j,"")},function(b,c){if(b)return a(b);c.host=hd(j,""),a(null,c)})}).catch(a)},h.get=e("get",function(a,b,c){function e(a){function c(c){var f=e[c],h=dd(a._id)+"/"+g(c)+"?rev="+a._rev;return d(b,{method:"GET",url:hd(j,h),binary:!0}).then(function(a){return b.binary?a:new ne(function(b){Jb(a,b)})}).then(function(a){delete f.stub,delete f.length,f.data=a})}var e=a._attachments,f=e&&Object.keys(e);if(e&&f.length){return bd(f.map(function(a){return function(){return c(a)}}),5)}}function f(a){return Array.isArray(a)?ne.all(a.map(function(a){if(a.ok)return e(a.ok)})):e(a)}"function"==typeof b&&(c=b,b={}),b=i(b);var h={};b.revs&&(h.revs=!0),b.revs_info&&(h.revs_info=!0),b.latest&&(h.latest=!0),b.open_revs&&("all"!==b.open_revs&&(b.open_revs=JSON.stringify(b.open_revs)),h.open_revs=b.open_revs),b.rev&&(h.rev=b.rev),b.conflicts&&(h.conflicts=b.conflicts),a=dd(a);var k={method:"GET",url:hd(j,a+jd(h))};d(b,k).then(function(a){return ne.resolve().then(function(){if(b.attachments)return f(a)}).then(function(){c(null,a)})}).catch(function(b){b.docId=a,c(b)})}),h.remove=e("remove",function(a,b,d,e){var f;"string"==typeof b?(f={_id:a,_rev:b},"function"==typeof d&&(e=d,d={})):(f=a,"function"==typeof b?(e=b,d={}):(e=d,d=b));var g=f._rev||d.rev;c(d,{method:"DELETE",url:hd(j,dd(f._id))+"?rev="+g},e)}),h.getAttachment=e("getAttachment",function(a,b,d,e){"function"==typeof d&&(e=d,d={});var f=d.rev?"?rev="+d.rev:"";c(d,{method:"GET",url:hd(j,dd(a))+"/"+g(b)+f,binary:!0},e)}),h.removeAttachment=e("removeAttachment",function(a,b,d,e){c({},{method:"DELETE",url:hd(j,dd(a)+"/"+g(b))+"?rev="+d},e)}),h.putAttachment=e("putAttachment",function(a,b,d,e,f,h){"function"==typeof f&&(h=f,f=e,e=d,d=null);var i=dd(a)+"/"+g(b),k=hd(j,i);if(d&&(k+="?rev="+d),"string"==typeof e){var m;try{m=_e(e)}catch(a){return h(E(De,"Attachment is not a valid base64 string"))}e=m?Eb(m,f):""}c({},{headers:{"Content-Type":f},method:"PUT",url:k,processData:!1,body:e,timeout:l.timeout||6e4},h)}),h._bulkDocs=function(a,b,d){a.new_edits=b.new_edits,f().then(function(){return ne.all(a.docs.map(ed))}).then(function(){c(b,{method:"POST",url:hd(j,"_bulk_docs"),timeout:b.timeout,body:a},function(a,b){if(a)return d(a);b.forEach(function(a){a.ok=!0}),d(null,b)})}).catch(d)},h._put=function(a,b,d){f().then(function(){return ed(a)}).then(function(){c(b,{method:"PUT",url:hd(j,dd(a._id)),body:a},function(b,c){if(b)return b.docId=a&&a._id,d(b);d(null,c)})}).catch(d)},h.allDocs=e("allDocs",function(a,b){"function"==typeof a&&(b=a,a={}),a=i(a);var c,e={},f="GET";a.conflicts&&(e.conflicts=!0),a.descending&&(e.descending=!0),a.include_docs&&(e.include_docs=!0),a.attachments&&(e.attachments=!0),a.key&&(e.key=JSON.stringify(a.key)),a.start_key&&(a.startkey=a.start_key),a.startkey&&(e.startkey=JSON.stringify(a.startkey)),a.end_key&&(a.endkey=a.end_key),a.endkey&&(e.endkey=JSON.stringify(a.endkey)),void 0!==a.inclusive_end&&(e.inclusive_end=!!a.inclusive_end),void 0!==a.limit&&(e.limit=a.limit),void 0!==a.skip&&(e.skip=a.skip);var g=jd(e);void 0!==a.keys&&(f="POST",c={keys:a.keys}),d(a,{method:f,url:hd(j,"_all_docs"+g),body:c}).then(function(c){a.include_docs&&a.attachments&&a.binary&&c.rows.forEach(cd),b(null,c)}).catch(b)}),h._changes=function(a){var b="batch_size"in a?a.batch_size:Mf;a=i(a),!a.continuous||"heartbeat"in a||(a.heartbeat=Pf);var d="timeout"in a?a.timeout:"timeout"in l?l.timeout:3e4;"timeout"in a&&a.timeout&&d-a.timeout<Of&&(d=a.timeout+Of),"heartbeat"in a&&a.heartbeat&&d-a.heartbeat<Of&&(d=a.heartbeat+Of);var e={};"timeout"in a&&a.timeout&&(e.timeout=a.timeout);var g,h=void 0!==a.limit&&a.limit;g="return_docs"in a?a.return_docs:!("returnDocs"in a)||a.returnDocs;var k=h;if(a.style&&(e.style=a.style),(a.include_docs||a.filter&&"function"==typeof a.filter)&&(e.include_docs=!0),a.attachments&&(e.attachments=!0),a.continuous&&(e.feed="longpoll"),a.conflicts&&(e.conflicts=!0),a.descending&&(e.descending=!0),"heartbeat"in a&&a.heartbeat&&(e.heartbeat=a.heartbeat),a.filter&&"string"==typeof a.filter&&(e.filter=a.filter),a.view&&"string"==typeof a.view&&(e.filter="_view",e.view=a.view),a.query_params&&"object"==typeof a.query_params)for(var m in a.query_params)a.query_params.hasOwnProperty(m)&&(e[m]=a.query_params[m]);var n,o="GET";a.doc_ids?(e.filter="_doc_ids",o="POST",n={doc_ids:a.doc_ids}):a.selector&&(e.filter="_selector",o="POST",n={selector:a.selector});var p,q,r=function(g,i){if(!a.aborted){e.since=g,"object"==typeof e.since&&(e.since=JSON.stringify(e.since)),a.descending?h&&(e.limit=k):e.limit=!h||k>b?b:k;var l={method:o,url:hd(j,"_changes"+jd(e)),timeout:d,body:n};q=g,a.aborted||f().then(function(){p=c(a,l,i)}).catch(i)}},s={results:[]},t=function(c,d){if(!a.aborted){var e=0;if(d&&d.results){e=d.results.length,s.last_seq=d.last_seq;({}).query=a.query_params,d.results=d.results.filter(function(b){k--;var c=H(a)(b);return c&&(a.include_docs&&a.attachments&&a.binary&&cd(b),g&&s.results.push(b),a.onChange(b)),c})}else if(c)return a.aborted=!0,void a.complete(c);d&&d.last_seq&&(q=d.last_seq);var f=h&&k<=0||d&&e<b||a.descending;(!a.continuous||h&&k<=0)&&f?a.complete(null,s):je(function(){r(q,t)})}};return r(a.since||0,t),{cancel:function(){a.aborted=!0,p&&p.abort()}}},h.revsDiff=e("revsDiff",function(a,b,d){"function"==typeof b&&(d=b,b={}),c(b,{method:"POST",url:hd(j,"_revs_diff"),body:a},d)}),h._close=function(a){a()},h._destroy=function(a,b){c(a,{url:hd(j,""),method:"DELETE"},function(a,c){if(a&&a.status&&404!==a.status)return b(a);b(null,c)})}}function ld(a){this.status=400,this.name="query_parse_error",this.message=a,this.error=!0;try{Error.captureStackTrace(this,ld)}catch(a){}}function md(a){this.status=404,this.name="not_found",this.message=a,this.error=!0;try{Error.captureStackTrace(this,md)}catch(a){}}function nd(a){this.status=500,this.name="invalid_value",this.message=a,this.error=!0;try{Error.captureStackTrace(this,nd)}catch(a){}}function od(a,b){return b&&a.then(function(a){je(function(){b(null,a)})},function(a){je(function(){b(a)})}),a}function pd(a){return ge(function(b){var c=b.pop(),d=a.apply(this,b);return"function"==typeof c&&od(d,c),d})}function qd(a,b){return a.then(function(a){return b().then(function(){return a})},function(a){return b().then(function(){throw a})})}function rd(a,b){return function(){var c=arguments,d=this;return a.add(function(){return b.apply(d,c)})}}function sd(a){var b=new qe(a),c=new Array(b.size),d=-1;return b.forEach(function(a){c[++d]=a}),c}function td(a){var b=new Array(a.size),c=-1;return a.forEach(function(a,d){b[++c]=d}),b}function ud(a){return new nd("builtin "+a+" function requires map values to be numbers or number arrays")}function vd(a){for(var b=0,c=0,d=a.length;c<d;c++){var e=a[c];if("number"!=typeof e){if(!Array.isArray(e))throw ud("_sum");b="number"==typeof b?[b]:b;for(var f=0,g=e.length;f<g;f++){var h=e[f];if("number"!=typeof h)throw ud("_sum");void 0===b[f]?b.push(h):b[f]+=h}}else"number"==typeof b?b+=e:b[0]+=e}return b}function wd(a,b){return Q("return ("+a.replace(/;\s*$/,"")+");",{emit:b,sum:vd,log:Sf,isArray:Tf,toJSON:Uf})}function xd(){this.promise=new ne(function(a){a()})}function yd(a){if(!a)return"undefined";switch(typeof a){case"function":case"string":return a.toString();default:return JSON.stringify(a)}}function zd(a,b){return yd(a)+yd(b)+"undefined"}function Ad(a,b,c,d,e,f){var g,h=zd(c,d);if(!e&&(g=a._cachedViews=a._cachedViews||{},g[h]))return g[h];var i=a.info().then(function(i){function j(a){a.views=a.views||{};var c=b;-1===c.indexOf("/")&&(c=b+"/"+b);var d=a.views[c]=a.views[c]||{};if(!d[k])return d[k]=!0,a}var k=i.db_name+"-mrview-"+(e?"temp":Qb(h));return R(a,"_local/"+f,j).then(function(){return a.registerDependentDatabase(k).then(function(b){var e=b.db;e.auto_compaction=!0;var f={name:k,db:e,sourceDB:a,adapter:a.adapter,mapFun:c,reduceFun:d};return f.db.get("_local/lastSeq").catch(function(a){if(404!==a.status)throw a}).then(function(a){return f.seq=a?a.seq:0,g&&f.db.once("destroyed",function(){delete g[h]}),f})})})});return g&&(g[h]=i),i}function Bd(a){return-1===a.indexOf("/")?[a,a]:a.split("/")}function Cd(a){return 1===a.length&&/^1-/.test(a[0].rev)}function Dd(a,b){try{a.emit("error",b)}catch(a){z("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),z("error",b)}}function Ed(a){if(/^_sum/.test(a))return Yf._sum;if(/^_count/.test(a))return Yf._count;if(/^_stats/.test(a))return Yf._stats;if(/^_/.test(a))throw new Error(a+" is not a supported reduce function.")}function Fd(a,b){if("function"==typeof a&&2===a.length){var c=a;return function(a){return c(a,b)}}return wd(a.toString(),b)}function Gd(a){var b=a.toString(),c=Ed(b);return c||wd(b)}function Hd(a,b){var c=a.views&&a.views[b];if("string"!=typeof c.map)throw new md("ddoc "+a._id+" has no string view named "+b+", instead found object of type: "+typeof c.map)}function Id(a,b,c){return Zf.query.call(this,a,b,c)}function Jd(a){return Zf.viewCleanup.call(this,a)}function Kd(a){return/^1-/.test(a)}function Ld(a,b,c){return!a._attachments||!a._attachments[c]||a._attachments[c].digest!==b._attachments[c].digest}function Md(a,b){var c=Object.keys(b._attachments);return ne.all(c.map(function(c){return a.getAttachment(b._id,c,{rev:b._rev})}))}function Nd(a,b,c){var d=L(b)&&!L(a),e=Object.keys(c._attachments);return d?a.get(c._id).then(function(d){return ne.all(e.map(function(e){return Ld(d,c,e)?b.getAttachment(c._id,e):a.getAttachment(d._id,e)}))}).catch(function(a){if(404!==a.status)throw a;return Md(b,c)}):Md(b,c)}function Od(a){var b=[];return Object.keys(a).forEach(function(c){a[c].missing.forEach(function(a){b.push({id:c,rev:a})})}),{docs:b,revs:!0,latest:!0}}function Pd(a,b,c,d){function e(){var e=Od(c);if(e.docs.length)return a.bulkGet(e).then(function(c){if(d.cancelled)throw new Error("cancelled");return ne.all(c.results.map(function(c){return ne.all(c.docs.map(function(c){var d=c.ok;return c.error&&(m=!1),d&&d._attachments?Nd(b,a,d).then(function(a){var b=Object.keys(d._attachments);return a.forEach(function(a,c){var e=d._attachments[b[c]];delete e.stub,delete e.length,e.data=a}),d}):d}))})).then(function(a){l=l.concat(I(a).filter(Boolean))})})}function f(a){return a._attachments&&Object.keys(a._attachments).length>0}function g(a){return a._conflicts&&a._conflicts.length>0}function h(b){return a.allDocs({keys:b,include_docs:!0,conflicts:!0}).then(function(a){if(d.cancelled)throw new Error("cancelled");a.rows.forEach(function(a){a.deleted||!a.doc||!Kd(a.value.rev)||f(a.doc)||g(a.doc)||(a.doc._conflicts&&delete a.doc._conflicts,l.push(a.doc),delete c[a.id])})})}function j(){var a=Object.keys(c).filter(function(a){var b=c[a].missing;return 1===b.length&&Kd(b[0])});if(a.length>0)return h(a)}function k(){return{ok:m,docs:l}}c=i(c);var l=[],m=!0;return ne.resolve().then(j).then(e).then(k)}function Qd(a,b,c,d,e){return a.get(b).catch(function(c){if(404===c.status)return"http"!==a.adapter&&"https"!==a.adapter||C(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:d,_id:b,history:[],replicator:ag,version:_f};throw c}).then(function(f){if(!e.cancelled&&f.last_seq!==c)return f.history=(f.history||[]).filter(function(a){return a.session_id!==d}),f.history.unshift({last_seq:c,session_id:d}),f.history=f.history.slice(0,bg),f.version=_f,f.replicator=ag,f.session_id=d,f.last_seq=c,a.put(f).catch(function(f){if(409===f.status)return Qd(a,b,c,d,e);throw f})})}function Rd(a,b,c,d,e){this.src=a,this.target=b,this.id=c,this.returnValue=d,this.opts=e}function Sd(a,b){return a.session_id===b.session_id?{last_seq:a.last_seq,history:a.history}:Td(a.history,b.history)}function Td(a,b){var c=a[0],d=a.slice(1),e=b[0],f=b.slice(1);return c&&0!==b.length?Ud(c.session_id,b)?{last_seq:c.last_seq,history:a}:Ud(e.session_id,d)?{last_seq:e.last_seq,history:f}:Td(d,f):{last_seq:cg,history:[]}}function Ud(a,b){var c=b[0],d=b.slice(1);return!(!a||0===b.length)&&(a===c.session_id||Ud(a,d))}function Vd(a){return"number"==typeof a.status&&4===Math.floor(a.status/100)}function Wd(a,b,c,d){if(!1===a.retry)return b.emit("error",c),void b.removeAllListeners();if("function"!=typeof a.back_off_function&&(a.back_off_function=B),b.emit("requestError",c),"active"===b.state||"pending"===b.state){b.emit("paused",c),b.state="stopped";var e=function(){a.current_back_off=eg},f=function(){b.removeListener("active",e)};b.once("paused",f),b.once("active",e)}a.current_back_off=a.current_back_off||eg,a.current_back_off=a.back_off_function(a.current_back_off),setTimeout(d,a.current_back_off)}function Xd(a){return Object.keys(a).sort(Sa).reduce(function(b,c){return b[c]=a[c],b},{})}function Yd(a,b,c){var d=c.doc_ids?c.doc_ids.sort(Sa):"",e=c.filter?c.filter.toString():"",f="",g="",h="";return c.selector&&(h=JSON.stringify(c.selector)),c.filter&&c.query_params&&(f=JSON.stringify(Xd(c.query_params))),c.filter&&"_view"===c.filter&&(g=c.view.toString()),ne.all([a.id(),b.id()]).then(function(a){var b=a[0]+a[1]+e+g+f+d+h;return new ne(function(a){Pb(b,a)})}).then(function(a){return"_local/"+(a=a.replace(/\//g,".").replace(/\+/g,"_"))})}function Zd(a,b,c,d,e){function f(){return x?ne.resolve():Yd(a,b,c).then(function(e){w=e;var f={};f=!1===c.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===c.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===c.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},x=new Rd(a,b,w,d,f)})}function g(){if(M=[],0!==v.docs.length){var a=v.docs,f={timeout:c.timeout};return b.bulkDocs({docs:a,new_edits:!1},f).then(function(b){if(d.cancelled)throw o(),new Error("cancelled");var c=Object.create(null);b.forEach(function(a){a.error&&(c[a.id]=a)});var f=Object.keys(c).length;e.doc_write_failures+=f,e.docs_written+=a.length-f,a.forEach(function(a){var b=c[a._id];if(b){if(e.errors.push(b),"unauthorized"!==b.name&&"forbidden"!==b.name)throw b;d.emit("denied",i(b))}else M.push(a)})},function(b){throw e.doc_write_failures+=a.length,b})}}function h(){if(v.error)throw new Error("There was a problem getting docs.");e.last_seq=D=v.seq;var a=i(e);return M.length&&(a.docs=M,d.emit("change",a)),A=!0,x.writeCheckpoint(v.seq,N).then(function(){if(A=!1,d.cancelled)throw o(),new Error("cancelled");v=void 0,s()}).catch(function(a){throw u(a),a})}function j(){var a={};return v.changes.forEach(function(b){"_user/"!==b.id&&(a[b.id]=b.changes.map(function(a){return a.rev}))}),b.revsDiff(a).then(function(a){if(d.cancelled)throw o(),new Error("cancelled");v.diffs=a})}function k(){return Pd(a,b,v.diffs,d).then(function(a){v.error=!a.ok,a.docs.forEach(function(a){delete v.diffs[a._id],e.docs_read++,v.docs.push(a)})})}function l(){if(!d.cancelled&&!v){if(0===y.length)return void m(!0);v=y.shift(),j().then(k).then(g).then(h).then(l).catch(function(a){n("batch processing terminated with error",a)})}}function m(a){if(0===z.changes.length)return void(0!==y.length||v||((F&&O.live||B)&&(d.state="pending",d.emit("paused")),B&&o()));(a||B||z.changes.length>=G)&&(y.push(z),z={seq:0,changes:[],docs:[]},"pending"!==d.state&&"stopped"!==d.state||(d.state="active",d.emit("active")),l())}function n(a,b){C||(b.message||(b.message=a),e.ok=!1,e.status="aborting",y=[],z={seq:0,changes:[],docs:[]},o(b))}function o(f){C||d.cancelled&&(e.status="cancelled",A)||(e.status=e.status||"complete",e.end_time=new Date,e.last_seq=D,C=!0,f?(f=E(f),f.result=e,"unauthorized"===f.name||"forbidden"===f.name?(d.emit("error",f),d.removeAllListeners()):Wd(c,d,f,function(){Zd(a,b,c,d)})):(d.emit("complete",e),d.removeAllListeners()))}function p(a){if(d.cancelled)return o();H(c)(a)&&(z.seq=a.seq,z.changes.push(a),m(0===y.length&&O.live))}function q(a){if(J=!1,d.cancelled)return o();if(a.results.length>0)O.since=a.last_seq,s(),m(!0);else{var b=function(){F?(O.live=!0,s()):B=!0,m(!0)};v||0!==a.results.length?b():(A=!0,x.writeCheckpoint(a.last_seq,N).then(function(){A=!1,e.last_seq=D=a.last_seq,b()}).catch(u))}}function r(a){if(J=!1,d.cancelled)return o();n("changes rejected",a)}function s(){function b(){f.cancel()}function e(){d.removeListener("cancel",b)}if(!J&&!B&&y.length<I){J=!0,d._changes&&(d.removeListener("cancel",d._abortChanges),d._changes.cancel()),d.once("cancel",b);var f=a.changes(O).on("change",p);f.then(e,e),f.then(q).catch(r),c.retry&&(d._changes=f,d._abortChanges=b)}}function t(){f().then(function(){return d.cancelled?void o():x.getCheckpoint().then(function(a){D=a,O={since:D,limit:G,batch_size:G,style:"all_docs",doc_ids:K,selector:L,return_docs:!0},c.filter&&("string"!=typeof c.filter?O.include_docs=!0:O.filter=c.filter),"heartbeat"in c&&(O.heartbeat=c.heartbeat),"timeout"in c&&(O.timeout=c.timeout),c.query_params&&(O.query_params=c.query_params),c.view&&(O.view=c.view),s()})}).catch(function(a){n("getCheckpoint rejected with ",a)})}function u(a){A=!1,n("writeCheckpoint completed with error",a)}var v,w,x,y=[],z={seq:0,changes:[],docs:[]},A=!1,B=!1,C=!1,D=0,F=c.continuous||c.live||!1,G=c.batch_size||100,I=c.batches_limit||10,J=!1,K=c.doc_ids,L=c.selector,M=[],N=Re();e=e||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var O={};if(d.ready(a,b),d.cancelled)return void o();d._addedListeners||(d.once("cancel",o),"function"==typeof c.complete&&(d.once("error",c.complete),d.once("complete",function(a){c.complete(null,a)})),d._addedListeners=!0),void 0===c.since?t():f().then(function(){return A=!0,x.writeCheckpoint(c.since,N)}).then(function(){if(A=!1,d.cancelled)return void o();D=c.since,t()}).catch(u)}function $d(){he.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var a=this,b=new ne(function(b,c){a.once("complete",b),a.once("error",c)});a.then=function(a,c){return b.then(a,c)},a.catch=function(a){return b.catch(a)},a.catch(function(){})}function _d(a,b){var c=b.PouchConstructor;return"string"==typeof a?new c(a,b):a}function ae(a,b,c,d){if("function"==typeof c&&(d=c,c={}),void 0===c&&(c={}),c.doc_ids&&!Array.isArray(c.doc_ids))throw E(Ge,"`doc_ids` filter parameter is not a list.");c.complete=d,c=i(c),c.continuous=c.continuous||c.live,c.retry="retry"in c&&c.retry,c.PouchConstructor=c.PouchConstructor||this;var e=new $d(c);return Zd(_d(a,c),_d(b,c),c,e),e}function be(a,b,c,d){return"function"==typeof c&&(d=c,c={}),void 0===c&&(c={}),c=i(c),c.PouchConstructor=c.PouchConstructor||this,a=_d(a,c),b=_d(b,c),new ce(a,b,c,d)}function ce(a,b,c,d){function e(a){o.emit("change",{direction:"pull",change:a})}function f(a){o.emit("change",{direction:"push",change:a})}function g(a){o.emit("denied",{direction:"push",doc:a})}function h(a){o.emit("denied",{direction:"pull",doc:a})}function i(){o.pushPaused=!0,o.pullPaused&&o.emit("paused")}function j(){o.pullPaused=!0,o.pushPaused&&o.emit("paused")}function k(){o.pushPaused=!1,o.pullPaused&&o.emit("active",{direction:"push"})}function l(){o.pullPaused=!1,o.pushPaused&&o.emit("active",{direction:"pull"})}function m(a){return function(b,c){var d="change"===b&&(c===e||c===f),m="denied"===b&&(c===h||c===g),n="paused"===b&&(c===j||c===i),p="active"===b&&(c===l||c===k);(d||m||n||p)&&(b in r||(r[b]={}),r[b][a]=!0,2===Object.keys(r[b]).length&&o.removeAllListeners(b))}}function n(a,b,c){-1==a.listeners(b).indexOf(c)&&a.on(b,c)}var o=this;this.canceled=!1;var p=c.push?ve({},c,c.push):c,q=c.pull?ve({},c,c.pull):c;this.push=ae(a,b,p),this.pull=ae(b,a,q),this.pushPaused=!0,this.pullPaused=!0;var r={};c.live&&(this.push.on("complete",o.pull.cancel.bind(o.pull)),this.pull.on("complete",o.push.cancel.bind(o.push))),this.on("newListener",function(a){"change"===a?(n(o.pull,"change",e),n(o.push,"change",f)):"denied"===a?(n(o.pull,"denied",h),n(o.push,"denied",g)):"active"===a?(n(o.pull,"active",l),n(o.push,"active",k)):"paused"===a&&(n(o.pull,"paused",j),n(o.push,"paused",i))}),this.on("removeListener",function(a){"change"===a?(o.pull.removeListener("change",e),o.push.removeListener("change",f)):"denied"===a?(o.pull.removeListener("denied",h),o.push.removeListener("denied",g)):"active"===a?(o.pull.removeListener("active",l),o.push.removeListener("active",k)):"paused"===a&&(o.pull.removeListener("paused",j),o.push.removeListener("paused",i))}),this.pull.on("removeListener",m("pull")),this.push.on("removeListener",m("push"));var s=ne.all([this.push,this.pull]).then(function(a){var b={push:a[0],pull:a[1]};return o.emit("complete",b),d&&d(null,b),o.removeAllListeners(),b},function(a){if(o.cancel(),d?d(a):o.emit("error",a),o.removeAllListeners(),d)throw a});this.then=function(a,b){return s.then(a,b)},this.catch=function(a){return s.catch(a)}}function de(a){a.replicate=ae,a.sync=be,Object.defineProperty(a.prototype,"replicate",{get:function(){var a=this;return{from:function(b,c,d){return a.constructor.replicate(b,a,c,d)},to:function(b,c,d){return a.constructor.replicate(a,b,c,d)}}}}),a.prototype.sync=function(a,b,c){return this.constructor.sync(this,a,b,c)}}var ee=d(a(11)),fe=d(a(7)),ge=d(a(1)),he=a(4),ie=d(a(6)),je=d(a(5)),ke=d(a(2)),le=d(a(10)),me=d(a(16)),ne="function"==typeof Promise?Promise:fe,oe=Function.prototype.toString,pe=oe.call(Object);p.prototype.get=function(a){var b=n(a);return this._store[b]},p.prototype.set=function(a,b){var c=n(a);return this._store[c]=b,!0},p.prototype.has=function(a){return n(a)in this._store},p.prototype.delete=function(a){var b=n(a),c=b in this._store;return delete this._store[b],c},p.prototype.forEach=function(a){for(var b=Object.keys(this._store),c=0,d=b.length;c<d;c++){var e=b[c],f=this._store[e];e=o(e),a(f,e)}},Object.defineProperty(p.prototype,"size",{get:function(){return Object.keys(this._store).length}}),q.prototype.add=function(a){return this._store.set(a,!0)},q.prototype.has=function(a){return this._store.has(a)},q.prototype.forEach=function(a){this._store.forEach(function(b,c){a(c)})},Object.defineProperty(q.prototype,"size",{get:function(){return this._store.size}});var qe,re;!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var a=Object.getOwnPropertyDescriptor(Map,Symbol.species);return a&&"get"in a&&Map[Symbol.species]===Map}()?(qe=q,re=p):(qe=Set,re=Map);var se,te=6;if(v())se=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),se=!!localStorage.getItem("_pouch_check_localstorage")}catch(a){se=!1}ie(y,he.EventEmitter),y.prototype.addListener=function(a,b,c,d){function e(){function a(){g=!1}if(f._listeners[b]){if(g)return void(g="waiting");g=!0;var h=r(d,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);c.changes(h).on("change",function(a){a.seq>d.since&&!d.cancelled&&(d.since=a.seq,d.onChange(a))}).on("complete",function(){"waiting"===g&&je(e),g=!1}).on("error",a)}}if(!this._listeners[b]){var f=this,g=!1;this._listeners[b]=e,this.on(a,e)}},y.prototype.removeListener=function(a,b){b in this._listeners&&(he.EventEmitter.prototype.removeListener.call(this,a,this._listeners[b]),delete this._listeners[b])},y.prototype.notifyLocalWindows=function(a){v()?chrome.storage.local.set({dbName:a}):w()&&(localStorage[a]="a"===localStorage[a]?"b":"a")},y.prototype.notify=function(a){this.emit(a),this.notifyLocalWindows(a)};var ue;ue="function"==typeof Object.assign?Object.assign:function(a){for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(null!=d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b};var ve=ue;ie(D,Error),D.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var we=(new D(401,"unauthorized","Name or password is incorrect."),new D(400,"bad_request","Missing JSON list of 'docs'")),xe=new D(404,"not_found","missing"),ye=new D(409,"conflict","Document update conflict"),ze=new D(400,"bad_request","_id field must contain a string"),Ae=new D(412,"missing_id","_id is required for puts"),Be=new D(400,"bad_request","Only reserved document ids may start with underscore."),Ce=(new D(412,"precondition_failed","Database not open"),new D(500,"unknown_error","Database encountered an unknown error")),De=new D(500,"badarg","Some query argument is invalid"),Ee=(new D(400,"invalid_request","Request was invalid"),new D(400,"query_parse_error","Some query parameter is invalid")),Fe=new D(500,"doc_validation","Bad special document member"),Ge=new D(400,"bad_request","Something wrong with the request"),He=new D(400,"bad_request","Document must be a JSON object"),Ie=(new D(404,"not_found","Database not found"),new D(500,"indexed_db_went_bad","unknown")),Je=new D(500,"web_sql_went_bad","unknown"),Ke=(new D(500,"levelDB_went_went_bad","unknown"),new D(403,"forbidden","Forbidden by design doc validate_doc_update function"),new D(400,"bad_request","Invalid rev format")),Le=(new D(412,"file_exists","The database could not be created, the file already exists."),new D(412,"missing_stub","A pre-existing attachment stub wasn't found")),Me=(new D(413,"invalid_url","Provided URL is invalid"),J.name);var Ne=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Oe="queryKey",Pe=/(?:^|&)([^&=]*)=?([^&]*)/g,Qe=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Re=ee.v4;ie(oa,he.EventEmitter),oa.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},oa.prototype.validateChanges=function(a){var b=a.complete,c=this;Ca._changesFilterPlugin?Ca._changesFilterPlugin.validate(a,function(d){if(d)return b(d);c.doChanges(a)}):c.doChanges(a)},oa.prototype.doChanges=function(a){var b=this,c=a.complete;if(a=i(a),"live"in a&&!("continuous"in a)&&(a.continuous=a.live),a.processChange=pa,"latest"===a.since&&(a.since="now"),a.since||(a.since=0),"now"===a.since)return void this.db.info().then(function(d){if(b.isCancelled)return void c(null,{status:"cancelled"});a.since=d.update_seq,b.doChanges(a)},c);if(Ca._changesFilterPlugin){if(Ca._changesFilterPlugin.normalize(a),Ca._changesFilterPlugin.shouldFilter(this,a))return Ca._changesFilterPlugin.filter(this,a)}else["doc_ids","filter","selector","view"].forEach(function(b){b in a&&z("warn",'The "'+b+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in a||(a.descending=!1),a.limit=0===a.limit?1:a.limit,a.complete=c;var d=this.db._changes(a);if(d&&"function"==typeof d.cancel){var e=b.cancel;b.cancel=ge(function(a){d.cancel(),e.apply(this,a)})}},ie(ya,he.EventEmitter),ya.prototype.post=m("post",function(a,b,c){if("function"==typeof b&&(c=b,b={}),"object"!=typeof a||Array.isArray(a))return c(E(He));this.bulkDocs({docs:[a]},b,ra(c,a._id))}),ya.prototype.put=m("put",function(a,b,c){function d(c){"function"==typeof e._put&&!1!==b.new_edits?e._put(a,b,c):e.bulkDocs({docs:[a]},b,ra(c,a._id))}if("function"==typeof b&&(c=b,b={}),"object"!=typeof a||Array.isArray(a))return c(E(He));if(K(a._id),la(a._id)&&"function"==typeof this._putLocal)return a._deleted?this._removeLocal(a,c):this._putLocal(a,c);var e=this;b.force&&a._rev?(!function(){var c=a._rev.split("-"),d=c[1],e=parseInt(c[0],10),f=e+1,g=T();a._revisions={start:f,ids:[g,d]},a._rev=f+"-"+g,b.new_edits=!1}(),d(function(b){var d=b?null:{ok:!0,id:a._id,rev:a._rev};c(b,d)})):d(c)}),ya.prototype.putAttachment=m("putAttachment",function(a,b,c,d,e){function f(a){var c="_rev"in a?parseInt(a._rev,10):0;return a._attachments=a._attachments||{},a._attachments[b]={content_type:e,data:d,revpos:++c},g.put(a)}var g=this;return"function"==typeof e&&(e=d,d=c,c=null),void 0===e&&(e=d,d=c,c=null),e||z("warn","Attachment",b,"on document",a,"is missing content_type"),g.get(a).then(function(a){if(a._rev!==c)throw E(ye);return f(a)},function(b){if(b.reason===xe.message)return f({_id:a});throw b})}),ya.prototype.removeAttachment=m("removeAttachment",function(a,b,c,d){var e=this;e.get(a,function(a,f){
return a?void d(a):f._rev!==c?void d(E(ye)):f._attachments?(delete f._attachments[b],0===Object.keys(f._attachments).length&&delete f._attachments,void e.put(f,d)):d()})}),ya.prototype.remove=m("remove",function(a,b,c,d){var e;"string"==typeof b?(e={_id:a,_rev:b},"function"==typeof c&&(d=c,c={})):(e=a,"function"==typeof b?(d=b,c={}):(d=c,c=b)),c=c||{},c.was_delete=!0;var f={_id:e._id,_rev:e._rev||c.rev};if(f._deleted=!0,la(f._id)&&"function"==typeof this._removeLocal)return this._removeLocal(e,d);this.bulkDocs({docs:[f]},c,ra(d,f._id))}),ya.prototype.revsDiff=m("revsDiff",function(a,b,c){function d(a,b){h.has(a)||h.set(a,{missing:[]}),h.get(a).missing.push(b)}function e(b,c){var e=a[b].slice(0);V(c,function(a,c,f,g,h){var i=c+"-"+f,j=e.indexOf(i);-1!==j&&(e.splice(j,1),"available"!==h.status&&d(b,i))}),e.forEach(function(a){d(b,a)})}"function"==typeof b&&(c=b,b={});var f=Object.keys(a);if(!f.length)return c(null,{});var g=0,h=new re;f.map(function(b){this._getRevisionTree(b,function(d,i){if(d&&404===d.status&&"missing"===d.message)h.set(b,{missing:a[b]});else{if(d)return c(d);e(b,i)}if(++g===f.length){var j={};return h.forEach(function(a,b){j[b]=a}),c(null,j)}})},this)}),ya.prototype.bulkGet=m("bulkGet",function(a,b){u(this,a,b)}),ya.prototype.compactDocument=m("compactDocument",function(a,b,c){var d=this;this._getRevisionTree(a,function(e,f){if(e)return c(e);var g=ua(f),h=[],i=[];Object.keys(g).forEach(function(a){g[a]>b&&h.push(a)}),V(f,function(a,b,c,d,e){var f=b+"-"+c;"available"===e.status&&-1!==h.indexOf(f)&&i.push(f)}),d._doCompaction(a,i,c)})}),ya.prototype.compact=m("compact",function(a,b){"function"==typeof a&&(b=a,a={});var c=this;a=a||{},c._compactionQueue=c._compactionQueue||[],c._compactionQueue.push({opts:a,callback:b}),1===c._compactionQueue.length&&wa(c)}),ya.prototype._compact=function(a,b){function c(a){g.push(e.compactDocument(a.id,0))}function d(a){var c=a.last_seq;ne.all(g).then(function(){return R(e,"_local/compaction",function(a){return(!a.last_seq||a.last_seq<c)&&(a.last_seq=c,a)})}).then(function(){b(null,{ok:!0})}).catch(b)}var e=this,f={return_docs:!1,last_seq:a.last_seq||0},g=[];e.changes(f).on("change",c).on("complete",d).on("error",b)},ya.prototype.get=m("get",function(a,b,c){function d(){var d=[],g=e.length;if(!g)return c(null,d);e.forEach(function(e){f.get(a,{rev:e,revs:b.revs,latest:b.latest,attachments:b.attachments},function(a,b){if(a)d.push({missing:e});else{for(var f,h=0,i=d.length;h<i;h++)if(d[h].ok&&d[h].ok._rev===b._rev){f=!0;break}f||d.push({ok:b})}--g||c(null,d)})})}if("function"==typeof b&&(c=b,b={}),"string"!=typeof a)return c(E(ze));if(la(a)&&"function"==typeof this._getLocal)return this._getLocal(a,c);var e=[],f=this;if(!b.open_revs)return this._get(a,b,function(d,e){if(d)return d.docId=a,c(d);var g=e.doc,h=e.metadata,i=e.ctx;if(b.conflicts){var j=Y(h);j.length&&(g._conflicts=j)}if(ka(h,g._rev)&&(g._deleted=!0),b.revs||b.revs_info){for(var k=g._rev.split("-"),l=parseInt(k[0],10),m=k[1],n=$(h.rev_tree),o=null,p=0;p<n.length;p++){var q=n[p],r=q.ids.map(function(a){return a.id}).indexOf(m);(r===l-1||!o&&-1!==r)&&(o=q)}var s=o.ids.map(function(a){return a.id}).indexOf(g._rev.split("-")[1])+1,t=o.ids.length-s;if(o.ids.splice(s,t),o.ids.reverse(),b.revs&&(g._revisions={start:o.pos+o.ids.length-1,ids:o.ids.map(function(a){return a.id})}),b.revs_info){var u=o.pos+o.ids.length;g._revs_info=o.ids.map(function(a){return u--,{rev:u+"-"+a.id,status:a.opts.status}})}}if(b.attachments&&g._attachments){var v=g._attachments,w=Object.keys(v).length;if(0===w)return c(null,g);Object.keys(v).forEach(function(a){this._getAttachment(g._id,a,v[a],{rev:g._rev,binary:b.binary,ctx:i},function(b,d){var e=g._attachments[a];e.data=d,delete e.stub,delete e.length,--w||c(null,g)})},f)}else{if(g._attachments)for(var x in g._attachments)g._attachments.hasOwnProperty(x)&&(g._attachments[x].stub=!0);c(null,g)}});if("all"===b.open_revs)this._getRevisionTree(a,function(a,b){if(a)return c(a);e=X(b).map(function(a){return a.rev}),d()});else{if(!Array.isArray(b.open_revs))return c(E(Ce,"function_clause"));e=b.open_revs;for(var g=0;g<e.length;g++){var h=e[g];if("string"!=typeof h||!/^\d+-/.test(h))return c(E(Ke))}d()}}),ya.prototype.getAttachment=m("getAttachment",function(a,b,c,d){var e=this;c instanceof Function&&(d=c,c={}),this._get(a,c,function(f,g){return f?d(f):g.doc._attachments&&g.doc._attachments[b]?(c.ctx=g.ctx,c.binary=!0,e._getAttachment(a,b,g.doc._attachments[b],c,d),void 0):d(E(xe))})}),ya.prototype.allDocs=m("allDocs",function(a,b){if("function"==typeof a&&(b=a,a={}),a.skip=void 0!==a.skip?a.skip:0,a.start_key&&(a.startkey=a.start_key),a.end_key&&(a.endkey=a.end_key),"keys"in a){if(!Array.isArray(a.keys))return b(new TypeError("options.keys must be an array"));var c=["startkey","endkey","key"].filter(function(b){return b in a})[0];if(c)return void b(E(Ee,"Query parameter `"+c+"` is not compatible with multi-get"));if(!L(this))return va(this,a,b)}return this._allDocs(a,b)}),ya.prototype.changes=function(a,b){return"function"==typeof a&&(b=a,a={}),new oa(this,a,b)},ya.prototype.close=m("close",function(a){return this._closed=!0,this.emit("closed"),this._close(a)}),ya.prototype.info=m("info",function(a){var b=this;this._info(function(c,d){if(c)return a(c);d.db_name=d.db_name||b.name,d.auto_compaction=!(!b.auto_compaction||L(b)),d.adapter=b.adapter,a(null,d)})}),ya.prototype.id=m("id",function(a){return this._id(a)}),ya.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},ya.prototype.bulkDocs=m("bulkDocs",function(a,b,c){if("function"==typeof b&&(c=b,b={}),b=b||{},Array.isArray(a)&&(a={docs:a}),!a||!a.docs||!Array.isArray(a.docs))return c(E(we));for(var d=0;d<a.docs.length;++d)if("object"!=typeof a.docs[d]||Array.isArray(a.docs[d]))return c(E(He));var e;if(a.docs.forEach(function(a){a._attachments&&Object.keys(a._attachments).forEach(function(b){e=e||xa(b),a._attachments[b].content_type||z("warn","Attachment",b,"on document",a._id,"is missing content_type")})}),e)return c(E(Ge,e));"new_edits"in b||(b.new_edits=!("new_edits"in a)||a.new_edits);var f=this;b.new_edits||L(f)||a.docs.sort(ta),sa(a.docs);var g=a.docs.map(function(a){return a._id});return this._bulkDocs(a,b,function(a,d){if(a)return c(a);if(b.new_edits||(d=d.filter(function(a){return a.error})),!L(f))for(var e=0,h=d.length;e<h;e++)d[e].id=d[e].id||g[e];c(null,d)})}),ya.prototype.registerDependentDatabase=m("registerDependentDatabase",function(a,b){function c(b){return b.dependentDbs=b.dependentDbs||{},!b.dependentDbs[a]&&(b.dependentDbs[a]=!0,b)}var d=new this.constructor(a,this.__opts);R(this,"_local/_pouch_dependentDbs",c).then(function(){b(null,{db:d})}).catch(b)}),ya.prototype.destroy=m("destroy",function(a,b){function c(){d._destroy(a,function(a,c){if(a)return b(a);d._destroyed=!0,d.emit("destroyed"),b(null,c||{ok:!0})})}"function"==typeof a&&(b=a,a={});var d=this,e=!("use_prefix"in d)||d.use_prefix;if(L(d))return c();d.get("_local/_pouch_dependentDbs",function(a,f){if(a)return 404!==a.status?b(a):c();var g=f.dependentDbs,h=d.constructor,i=Object.keys(g).map(function(a){var b=e?a.replace(new RegExp("^"+h.prefix),""):a;return new h(b,d.__opts).destroy()});ne.all(i).then(c,b)})}),za.prototype.execute=function(){var a;if(this.failed)for(;a=this.queue.shift();)a(this.failed);else for(;a=this.queue.shift();)a()},za.prototype.fail=function(a){this.failed=a,this.execute()},za.prototype.ready=function(a){this.isReady=!0,this.db=a,this.execute()},za.prototype.addTask=function(a){this.queue.push(a),this.failed&&this.execute()},ie(Ca,ya),Ca.adapters={},Ca.preferredAdapters=[],Ca.prefix="_pouch_";var Se=new he.EventEmitter;!function(a){Object.keys(he.EventEmitter.prototype).forEach(function(b){"function"==typeof he.EventEmitter.prototype[b]&&(a[b]=Se[b].bind(Se))});var b=a._destructionListeners=new re;a.on("ref",function(a){b.has(a.name)||b.set(a.name,[]),b.get(a.name).push(a)}),a.on("unref",function(a){if(b.has(a.name)){var c=b.get(a.name),d=c.indexOf(a);d<0||(c.splice(d,1),c.length>1?b.set(a.name,c):b.delete(a.name))}}),a.on("destroyed",function(a){if(b.has(a)){var c=b.get(a);b.delete(a),c.forEach(function(a){a.emit("destroyed",!0)})}})}(Ca),Ca.adapter=function(a,b,c){b.valid()&&(Ca.adapters[a]=b,c&&Ca.preferredAdapters.push(a))},Ca.plugin=function(a){if("function"==typeof a)a(Ca);else{if("object"!=typeof a||0===Object.keys(a).length)throw new Error('Invalid plugin: got "'+a+'", expected an object or a function');Object.keys(a).forEach(function(b){Ca.prototype[b]=a[b]})}return this.__defaults&&(Ca.__defaults=ve({},this.__defaults)),Ca},Ca.defaults=function(a){function b(a,c){if(!(this instanceof b))return new b(a,c);c=c||{},a&&"object"==typeof a&&(c=a,a=c.name,delete c.name),c=ve({},b.__defaults,c),Ca.call(this,a,c)}return ie(b,Ca),b.preferredAdapters=Ca.preferredAdapters.slice(),Object.keys(Ca).forEach(function(a){a in b||(b[a]=Ca[a])}),b.__defaults=ve({},this.__defaults,a),b};var Te=["$or","$nor","$not"],Ue=-324,Ve=3,We="",Xe={$elemMatch:function(a,b,c,d){return!!Array.isArray(d)&&(0!==d.length&&("object"==typeof d[0]?d.some(function(a){return eb(a,b,Object.keys(b))}):d.some(function(d){return fb(b,a,c,d)})))},$allMatch:function(a,b,c,d){return!!Array.isArray(d)&&(0!==d.length&&("object"==typeof d[0]?d.every(function(a){return eb(a,b,Object.keys(b))}):d.every(function(d){return fb(b,a,c,d)})))},$eq:function(a,b,c,d){return jb(d)&&0===Sa(d,b)},$gte:function(a,b,c,d){return jb(d)&&Sa(d,b)>=0},$gt:function(a,b,c,d){return jb(d)&&Sa(d,b)>0},$lte:function(a,b,c,d){return jb(d)&&Sa(d,b)<=0},$lt:function(a,b,c,d){return jb(d)&&Sa(d,b)<0},$exists:function(a,b,c,d){return b?jb(d):!jb(d)},$mod:function(a,b,c,d){return ib(d)&&kb(d,b)},$ne:function(a,b,c,d){return b.every(function(a){return 0!==Sa(d,a)})},$in:function(a,b,c,d){return ib(d)&&lb(d,b)},$nin:function(a,b,c,d){return ib(d)&&!lb(d,b)},$size:function(a,b,c,d){return ib(d)&&nb(d,b)},$all:function(a,b,c,d){return Array.isArray(d)&&mb(d,b)},$regex:function(a,b,c,d){return ib(d)&&ob(d,b)},$type:function(a,b,c,d){return pb(d,b)}};Ca.plugin(Da),Ca.plugin(xb),Ca.version="6.3.4";var Ye,Ze=yb(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),$e=yb(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),_e=function(a){return atob(a)},af=function(a){return btoa(a)},bf=c.setImmediate||c.setTimeout,cf=32768,df=5,ef="document-store",ff="by-sequence",gf="attach-store",hf="attach-seq-store",jf="meta-store",kf="local-store",lf="detect-blob-support",mf=new y,nf=!1,of=[],pf=new re,qf=new re;tc.valid=function(){return!("undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform))&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var rf=function(a){a.adapter("idb",tc,!0)},sf=7,tf=Bc("document-store"),uf=Bc("by-sequence"),vf=Bc("attach-store"),wf=Bc("local-store"),xf=Bc("metadata-store"),yf=Bc("attach-seq-store"),zf=new re,Af=new y,Bf=1,Cf="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+uf+" (seq, deleted)",Df="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+uf+" (doc_id, rev)",Ef="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+tf+" (winningseq)",Ff="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+yf+" (seq)",Gf="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+yf+" (digest, seq)",Hf=uf+".seq = "+tf+".winningseq",If=uf+".seq AS seq, "+uf+".deleted AS deleted, "+uf+".json AS data, "+uf+".rev AS rev, "+tf+".json AS metadata";Vc.valid=Tc,Vc.use_prefix=!0;var Jf=function(a){a.adapter("websql",Vc,!0)},Kf=function(){try{return new XMLHttpRequest,!0}catch(a){return!1}}(),Lf=function(){},Mf=25,Nf=50,Of=5e3,Pf=1e4,Qf={};kd.valid=function(){return!0};var Rf=function(a){a.adapter("http",kd,!1),a.adapter("https",kd,!1)};ie(ld,Error),ie(md,Error),ie(nd,Error);var Sf=z.bind(null,"log"),Tf=Array.isArray,Uf=JSON.parse;xd.prototype.add=function(a){return this.promise=this.promise.catch(function(){}).then(function(){return a()}),this.promise},xd.prototype.finish=function(){return this.promise};var Vf={},Wf=new xd,Xf=50,Yf={_sum:function(a,b){return vd(b)},_count:function(a,b){return b.length},_stats:function(a,b){return{sum:vd(b),min:Math.min.apply(null,b),max:Math.max.apply(null,b),count:b.length,sumsqr:function(a){for(var b=0,c=0,d=a.length;c<d;c++){var e=a[c];b+=e*e}return b}(b)}}},Zf=function(a,b,c,d){function e(a,b,c){try{b(c)}catch(b){Dd(a,b)}}function f(a,b,c,d,e){try{return{output:b(c,d,e)}}catch(b){return Dd(a,b),{error:b}}}function g(a,b){var c=Sa(a.key,b.key);return 0!==c?c:Sa(a.value,b.value)}function h(a,b,c){return c=c||0,"number"==typeof b?a.slice(c,b+c):c>0?a.slice(c):a}function i(a){var b=a.value;return b&&"object"==typeof b&&b._id||a.id}function j(a){a.rows.forEach(function(a){var b=a.doc&&a.doc._attachments;b&&Object.keys(b).forEach(function(a){var c=b[a];b[a].data=Fb(c.data,c.content_type)})})}function k(a){return function(b){return a.include_docs&&a.attachments&&a.binary&&j(b),b}}function l(a,b,c,d){var e=b[a];void 0!==e&&(d&&(e=encodeURIComponent(JSON.stringify(e))),c.push(a+"="+e))}function m(a){if(void 0!==a){var b=Number(a);return isNaN(b)||b!==parseInt(a,10)?a:b}}function n(a){return a.group_level=m(a.group_level),a.limit=m(a.limit),a.skip=m(a.skip),a}function o(a){if(a){if("number"!=typeof a)return new ld('Invalid value for integer: "'+a+'"');if(a<0)return new ld('Invalid value for positive integer: "'+a+'"')}}function p(a,b){var c=a.descending?"endkey":"startkey",d=a.descending?"startkey":"endkey";if(void 0!==a[c]&&void 0!==a[d]&&Sa(a[c],a[d])>0)throw new ld("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(b.reduce&&!1!==a.reduce){if(a.include_docs)throw new ld("{include_docs:true} is invalid for reduce");if(a.keys&&a.keys.length>1&&!a.group&&!a.group_level)throw new ld("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(b){var c=o(a[b]);if(c)throw c})}function q(a,b,c){var d,e=[],f="GET";if(l("reduce",c,e),l("include_docs",c,e),l("attachments",c,e),l("limit",c,e),l("descending",c,e),l("group",c,e),l("group_level",c,e),l("skip",c,e),l("stale",c,e),l("conflicts",c,e),l("startkey",c,e,!0),l("start_key",c,e,!0),l("endkey",c,e,!0),l("end_key",c,e,!0),l("inclusive_end",c,e),l("key",c,e,!0),e=e.join("&"),e=""===e?"":"?"+e,void 0!==c.keys){var g="keys="+encodeURIComponent(JSON.stringify(c.keys));g.length+e.length+1<=2e3?e+=("?"===e[0]?"&":"?")+g:(f="POST","string"==typeof b?d={keys:c.keys}:b.keys=c.keys)}if("string"==typeof b){var h=Bd(b);return a.request({method:f,url:"_design/"+h[0]+"/_view/"+h[1]+e,body:d}).then(function(a){return a.rows.forEach(function(a){if(a.value&&a.value.error&&"builtin_reduce_error"===a.value.error)throw new Error(a.reason)}),a}).then(k(c))}return d=d||{},Object.keys(b).forEach(function(a){Array.isArray(b[a])?d[a]=b[a]:d[a]=b[a].toString()}),a.request({method:"POST",url:"_temp_view"+e,body:d}).then(k(c))}function r(a,b,c){return new ne(function(d,e){a._query(b,c,function(a,b){if(a)return e(a);d(b)})})}function s(a){return new ne(function(b,c){a._viewCleanup(function(a,d){if(a)return c(a);b(d)})})}function t(a){return function(b){if(404===b.status)return a;throw b}}function u(a,b,c){function d(a){return a.keys.length?b.db.allDocs({keys:a.keys,include_docs:!0}):ne.resolve({rows:[]})}function e(a,b){for(var c=[],d=new qe,e=0,f=b.rows.length;e<f;e++){var g=b.rows[e],h=g.doc;if(h&&(c.push(h),d.add(h._id),h._deleted=!i.has(h._id),!h._deleted)){var j=i.get(h._id);"value"in j&&(h.value=j.value)}}var k=td(i);return k.forEach(function(a){if(!d.has(a)){var b={_id:a},e=i.get(a);"value"in e&&(b.value=e.value),c.push(b)}}),a.keys=sd(k.concat(a.keys)),c.push(a),c}var f="_local/doc_"+a,g={_id:f,keys:[]},h=c.get(a),i=h[0],j=h[1];return function(){return Cd(j)?ne.resolve(g):b.db.get(f).catch(t(g))}().then(function(a){return d(a).then(function(b){return e(a,b)})})}function v(a,b,c){return a.db.get("_local/lastSeq").catch(t({_id:"_local/lastSeq",seq:0})).then(function(d){var e=td(b);return ne.all(e.map(function(c){return u(c,a,b)})).then(function(b){var e=I(b);return d.seq=c,e.push(d),a.db.bulkDocs({docs:e})})})}function w(a){var b="string"==typeof a?a:a.name,c=Vf[b];return c||(c=Vf[b]=new xd),c}function x(a){return rd(w(a),function(){return y(a)})()}function y(a){function c(a,b){var c={id:l._id,key:Ta(a)};void 0!==b&&null!==b&&(c.value=Ta(b)),k.push(c)}function d(b,c){return function(){return v(a,b,c)}}function f(){return a.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:n,limit:Xf}).then(h)}function h(a){var b=a.results;if(b.length){var c=i(b);if(o.add(d(c,n)),!(b.length<Xf))return f()}}function i(b){for(var c=new re,d=0,f=b.length;d<f;d++){var h=b[d];if("_"!==h.doc._id[0]){k=[],l=h.doc,l._deleted||e(a.sourceDB,m,l),k.sort(g);var i=j(k);c.set(h.doc._id,[i,h.changes])}n=h.seq}return c}function j(a){for(var b,c=new re,d=0,e=a.length;d<e;d++){var f=a[d],g=[f.key,f.id];d>0&&0===Sa(f.key,b)&&g.push(d),c.set(Va(g),f),b=f.key}return c}var k,l,m=b(a.mapFun,c),n=a.seq||0,o=new xd;return f().then(function(){return o.finish()}).then(function(){a.seq=n})}function z(a,b,d){0===d.group_level&&delete d.group_level;var e=d.group||d.group_level,g=c(a.reduceFun),i=[],j=isNaN(d.group_level)?Number.POSITIVE_INFINITY:d.group_level;b.forEach(function(a){var b=i[i.length-1],c=e?a.key:null;if(e&&Array.isArray(c)&&(c=c.slice(0,j)),b&&0===Sa(b.groupKey,c))return b.keys.push([a.key,a.id]),void b.values.push(a.value);i.push({keys:[[a.key,a.id]],values:[a.value],groupKey:c})}),b=[];for(var k=0,l=i.length;k<l;k++){var m=i[k],n=f(a.sourceDB,g,m.keys,m.values,!1);if(n.error&&n.error instanceof nd)throw n.error;b.push({value:n.error?null:n.output,key:m.groupKey})}return{rows:h(b,d.limit,d.skip)}}function A(a,b){return rd(w(a),function(){return B(a,b)})()}function B(a,b){function c(b){return b.include_docs=!0,a.db.allDocs(b).then(function(a){return e=a.total_rows,a.rows.map(function(a){if("value"in a.doc&&"object"==typeof a.doc.value&&null!==a.doc.value){var b=Object.keys(a.doc.value).sort(),c=["id","key","value"];if(!(b<c||b>c))return a.doc.value}var d=Ya(a.doc._id);return{key:d[0],id:d[1],value:"value"in a.doc?a.doc.value:null}})})}function d(c){var d;if(d=f?z(a,c,b):{total_rows:e,offset:g,rows:c},b.include_docs){var h=sd(c.map(i));return a.sourceDB.allDocs({keys:h,include_docs:!0,conflicts:b.conflicts,attachments:b.attachments,binary:b.binary}).then(function(a){var b=new re;return a.rows.forEach(function(a){b.set(a.id,a.doc)}),c.forEach(function(a){var c=i(a),d=b.get(c);d&&(a.doc=d)}),d})}return d}var e,f=a.reduceFun&&!1!==b.reduce,g=b.skip||0;if(void 0===b.keys||b.keys.length||(b.limit=0,delete b.keys),void 0!==b.keys){var h=b.keys,j=h.map(function(a){return c({startkey:Va([a]),endkey:Va([a,{}])})});return ne.all(j).then(I).then(d)}var k,l,m={descending:b.descending};if("start_key"in b&&(k=b.start_key),"startkey"in b&&(k=b.startkey),"end_key"in b&&(l=b.end_key),"endkey"in b&&(l=b.endkey),void 0!==k&&(m.startkey=Va(b.descending?[k,{}]:[k])),void 0!==l){var n=!1!==b.inclusive_end;b.descending&&(n=!n),m.endkey=Va(n?[l,{}]:[l])}if(void 0!==b.key){var o=Va([b.key]),p=Va([b.key,{}]);m.descending?(m.endkey=o,m.startkey=p):(m.startkey=o,m.endkey=p)}return f||("number"==typeof b.limit&&(m.limit=b.limit),m.skip=g),c(m).then(d)}function C(a){return a.request({method:"POST",url:"_view_cleanup"})}function D(b){return b.get("_local/"+a).then(function(a){var c=new re;Object.keys(a.views).forEach(function(a){var b=Bd(a),d="_design/"+b[0],e=b[1],f=c.get(d);f||(f=new qe,c.set(d,f)),f.add(e)});var d={keys:td(c),include_docs:!0};return b.allDocs(d).then(function(d){var e={};d.rows.forEach(function(b){var d=b.key.substring(8);c.get(b.key).forEach(function(c){var f=d+"/"+c;a.views[f]||(f=c);var g=Object.keys(a.views[f]),h=b.doc&&b.doc.views&&b.doc.views[c];g.forEach(function(a){e[a]=e[a]||h})})});var f=Object.keys(e).filter(function(a){return!e[a]}),g=f.map(function(a){return rd(w(a),function(){return new b.constructor(a,b.__opts).destroy()})()});return ne.all(g).then(function(){return{ok:!0}})})},t({ok:!0}))}function E(b,c,e){if("function"==typeof b._query)return r(b,c,e);if(L(b))return q(b,c,e);if("string"!=typeof c)return p(e,c),Wf.add(function(){return Ad(b,"temp_view/temp_view",c.map,c.reduce,!0,a).then(function(a){return qd(x(a).then(function(){return A(a,e)}),function(){return a.db.destroy()})})}),Wf.finish();var f=c,g=Bd(f),h=g[0],i=g[1];return b.get("_design/"+h).then(function(c){var g=c.views&&c.views[i];if(!g)throw new md("ddoc "+c._id+" has no view named "+i);return d(c,i),p(e,g),Ad(b,f,g.map,g.reduce,!1,a).then(function(a){return"ok"===e.stale||"update_after"===e.stale?("update_after"===e.stale&&je(function(){x(a)}),A(a,e)):x(a).then(function(){return A(a,e)})})})}function F(a,b,c){var d=this;"function"==typeof b&&(c=b,b={}),b=b?n(b):{},"function"==typeof a&&(a={map:a});var e=ne.resolve().then(function(){return E(d,a,b)});return od(e,c),e}return{query:F,viewCleanup:pd(function(){var a=this;return"function"==typeof a._viewCleanup?s(a):L(a)?C(a):D(a)})}}("mrviews",Fd,Gd,Hd),$f={query:Id,viewCleanup:Jd},_f=1,ag="pouchdb",bg=5,cg=0;Rd.prototype.writeCheckpoint=function(a,b){var c=this;return this.updateTarget(a,b).then(function(){return c.updateSource(a,b)})},Rd.prototype.updateTarget=function(a,b){return this.opts.writeTargetCheckpoint?Qd(this.target,this.id,a,b,this.returnValue):ne.resolve(!0)},Rd.prototype.updateSource=function(a,b){if(this.opts.writeSourceCheckpoint){var c=this;return this.readOnlySource?ne.resolve(!0):Qd(this.src,this.id,a,b,this.returnValue).catch(function(a){if(Vd(a))return c.readOnlySource=!0,!0;throw a})}return ne.resolve(!0)};var dg={undefined:function(a,b){return 0===Sa(a.last_seq,b.last_seq)?b.last_seq:0},1:function(a,b){return Sd(b,a).last_seq}};Rd.prototype.getCheckpoint=function(){var a=this;return a.target.get(a.id).then(function(b){return a.readOnlySource?ne.resolve(b.last_seq):a.src.get(a.id).then(function(a){if(b.version!==a.version)return cg;var c;return c=b.version?b.version.toString():"undefined",c in dg?dg[c](b,a):cg},function(c){if(404===c.status&&b.last_seq)return a.src.put({_id:a.id,last_seq:cg}).then(function(){return cg},function(c){return Vd(c)?(a.readOnlySource=!0,b.last_seq):cg});throw c})}).catch(function(a){if(404!==a.status)throw a;return cg})};var eg=0;ie($d,he.EventEmitter),$d.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},$d.prototype.ready=function(a,b){function c(){e.cancel()}function d(){a.removeListener("destroyed",c),b.removeListener("destroyed",c)}var e=this;e._readyCalled||(e._readyCalled=!0,a.once("destroyed",c),b.once("destroyed",c),e.once("complete",d))},ie(ce,he.EventEmitter),ce.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Ca.plugin(rf).plugin(Jf).plugin(Rf).plugin($f).plugin(de),b.exports=Ca}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,11:11,16:16,2:2,4:4,5:5,6:6,7:7}]},{},[17])(17)});
//# sourceMappingURL=pouchdb-6.3.4.js.map